```{r setup1, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(data.table)
library(sf)
library(ggplot2)
library(ggsflabel)
library(ggspatial)
library(knitr)
library(kableExtra)
library(TDX)
library(DT)
library(stringr)
library(jsonlite)
library(xml2)
library(tidyr)
library(ggridges)
library(TWspdata)
library(treemapify)
library(ggsankey)
library(ggradar)
library(ggtext)

Sys.setlocale(category = "LC_ALL", locale = "zh_TW.UTF-8")
windowsFonts(A=windowsFont("Taipei Sans TC Beta"))
windowsFonts(B=windowsFont("Consolas"))
```

# **資料視覺化**
資料視覺化是分析資料前相當重要的步驟，能夠將雜論無章的數據彙整為具有統計意義的圖，進而觀察資料趨勢與潛在的意涵；同時也是在資料分析後，用以呈現產出結果的重要手段，進而貫串整個分析的主題與故事。本章節介紹 R 語言中資料視覺化的方法，其中側重於`ggplot2`套件的使用，分別介紹不同圖表的應用與程式撰寫方式，並詳述圖表細節之設定，進而使圖表的呈現更加細緻與客製化。

`ggplot2`套件是在 R 語言中最為常見的繪圖工具，此名稱中的「gg」意謂著「**G**rammar of **G**raphics」，亦即使用此套件繪圖時乃依據特定的規則，如同語言中的「文法」。`ggplot2`套件提供多種不同的函式可繪製各類型圖表，並可進一步細緻調整圖表樣式，提升資料之可視性。

`ggplot2`繪圖方法主要由四個元素構成：資料與座標軸、圖表類型、尺度設定、主題設定，繪圖架構如圖\@ref(fig:ggplot2-fig)所示。

```{r ggplot2-fig, echo=F, eval=T, out.width="50%", fig.align="center", fig.cap="`ggplot2`繪圖架構"}
include_graphics("./figure/ggplot2.png")
```

以圖\@ref(fig:fig-exp)為例，各元素所控制的圖片要素彙整如下：  

* <span style="color:#BF9000">**資料與座標軸：**</span> 所輸入的資料為鳶尾花（iris）資料、設定花萼的長度（Sepal.Length）為橫軸；花萼的寬度（Sepal.Width）為縱軸  
* <span style="color:#002060;">**圖表類型：**</span> 使用點子圖  
* <span style="color:#548235;">**尺度設定：**</span> 將花瓣的寬度（Petal.Width）給定漸層顏色、將花瓣的長度（Petal.Length）給定點子大小  
* <span style="color:#C55A11;">**主題設定：**</span> 設定座標軸文字的顏色與大小、設定圖例的文字大小、粗細與背景顏色  

```{r fig-exp, echo=F, eval=T, out.width="60%", fig.align="center", fig.cap="繪圖範例"}
ggplot(data=iris, aes(x=Sepal.Length, y=Sepal.Width, color=Petal.Width, size=Petal.Length))+
  geom_point()+
  scale_color_distiller(palette="YlOrRd", direction=1)+
  scale_size_continuous(range=c(1,5))+
  theme(axis.title=element_text(size=15, color="#600000"),
        axis.text=element_text(size=12, color="#600000"),
        legend.key=element_blank(),
        legend.title=element_text(face="bold"),
        legend.background=element_rect(fill=NA),
        legend.box.background=element_rect(fill=alpha("#E0E0E0", 0.8), color="#ADADAD"))
```

本章僅介紹常見的圖表，並系統性彙整`ggplot2`套件的作圖概念，惟無法涵蓋所有圖表繪製與細節調整，建議可以直接在網路上利用關鍵字（盡可能用英文關鍵字，所得到的回饋會更多、更完整）搜索，藉此模仿他人的程式碼，並從中學習作圖技巧。此外，以下羅列非常豐富的 R 繪圖相簿，內含完整的程式碼可供觀摩：

* [The R Graph Gallery](https://r-graph-gallery.com/index.html)
* [R CHARTS](https://r-charts.com/)
* [from Data to Viz](https://www.data-to-viz.com/)
* [Visual Vocabulary](https://journalismcourses.org/wp-content/uploads/2020/07/Visual-vocabulary.pdf)


## 圖表類型

<!-- <p style="color:#003D79;font-size:18px;line-height:2">**⌾ 圖表類型彙整**</p>   -->
### **圖表類型彙整** {-}
本節彙整常見的圖表類型（如表\@ref(tab:tab-export-plot)），並介紹各圖表繪製方法，利用不同的資料視覺化呈現。

```{r tab-export-plot, echo=F, eval=T}
ggplot_summary=read.csv("./Data/ggplot Summary.csv")
temp1=paste0("./figure/ggplot/", ggplot_summary$Figure, ".png")
ggplot_summary$Figure=""
temp2=strsplit(ggplot_summary$Package, "\n")
temp2=mapply(function(y) mapply(function(x) paste0("`", temp2[[y]][x], "`"), c(1:length(temp2[[y]]))), c(1:length(temp2)))
temp2=mapply(function(x) paste(temp2[[x]], collapse="<br>"), c(1:length(temp2)))
temp2=gsub("\\*\\*\\`", "\\`\\*\\*", temp2)
temp2=gsub("\\`\\*\\*g", "\\*\\*\\`g", temp2)
temp2=gsub("\\`\\*\\*t", "\\*\\*\\`t", temp2)
ggplot_summary$Package=temp2
ggplot_summary$Function=paste0("`", ggplot_summary$Function, "`")

kable(ggplot_summary, booktabs=T, escape=F, caption="圖表類型彙整", col.names=c("圖表類型","特徵/應用","套件","函式","圖示"), align=c("llc"))%>%
  kable_styling(bootstrap_options=c("striped", "hover"), font_size=14)%>%
  column_spec(5, width="4.5cm")%>%
  column_spec(1:5, extra_css="vertical-align:middle;")%>%
  column_spec(5, image=spec_image(temp1, 375, 250))%>%
  row_spec(0, bold=T, color="white", background="#8E8E8E")%>%
  footnote("套件欄位中的**粗體字**為可以與`ggplot2`套件整合者")
```

### **初始化** {-}
如前文所提，`ggplot2`是依循著繪圖文法的套件，其最基礎的元素即是**資料與座標軸**，也就是繪製各類型圖表前的「畫布」，可利用`ggplot()`函式生成之，函式撰寫架構如下。

```{r ggplot-code, echo=T, eval=F}
ggplot(資料, aes(x=, y=))
```

以`iris`鳶尾花資料為例建立畫布，並以 Sepal.Length 為橫軸、Sepal.Width 為縱軸，設定最基礎的畫布，程式碼撰寫如下。

```{r ggplot-code-eg, echo=T, eval=T, out.width="70%", fig.align="center"}
ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width))
```


<H2 id="ggplot-aes"><p style="color:#003D79;font-size:18px;line-height:2">**⌾ `aes()`函式功能**</p></H2>  

`aes`表示「aesthetics（美學）」，用以定義圖表中「隨著資料有所變動」的資訊。舉例而言，繪製圖表的點與線時必須根據資料的座標而定，因此`x=`與`y=`兩引數務必放置於`aes()`函式中。而若希望不同資料點或線具有不同顏色（`color=`）、大小（`size=`）、粗細（`linewidth=`）、線條樣式（`linetype=`）等，則須透過資料控制之，此時亦應在該函式中設定各設計的細節。總結而論，**「隨著資料而有所變動的引數」必須放置於`aes()`函式內，「在圖表中皆固定者」必須放置於`aes()`函式外。**


### **圖示設定** {-}
在 R 語言中各類型圖表皆可能需要設定其形狀（`shape`）、線條樣式（`linetype`）、顏色（`color`）等，以下簡介各設定之代碼。

點的形狀在 R 語言中共 26 個預設代碼，詳列如圖\@ref(fig:geom-setting-shape)，可直接設定數字使用符號。此外，亦可自訂代碼，如設定「`"X"`」，即表示使用「X」符號。

<H2 id="geom-setting-shape"></H2>
```{r geom-setting-shape, echo=F, eval=T, out.width="65%", fig.align="center", fig.cap="點形狀代碼"}
temp=data.frame(id=c(0:25))%>%
  mutate(x=(id)%%6+1, y=5-(id)%/%6+1)
ggplot()+
  geom_point(data=temp, aes(x=x, y=y, shape=as.character(id)), stroke=1, size=6, fill="#FFFF37", show.legend=F)+
  scale_shape_manual(limits=factor(temp$id), values=temp$id)+
  geom_text(data=temp, aes(x=x, y=y+0.3, label=id), family="A", size=4.5)+
  theme_void()
```

線條樣式在 R 語言中共 7 個預設代碼，詳列如圖\@ref(fig:geom-setting-linetype)。

<H2 id="geom-setting-linetype"></H2>
```{r geom-setting-linetype, echo=F, eval=T, out.width="70%", fig.align="center", fig.cap="線條樣式代碼"}
temp=data.frame(id=rep(c(0:6), each=2), linetype=rep(c("blank","solid","dashed","dotted","dotdash","longdash","twodash"), each=2), x=rep(c(1,2), times=7))
ggplot()+
  geom_line(data=temp, aes(x=x, y=id, group=id, linetype=factor(id)), linewidth=1, show.legend=F)+
  scale_linetype_manual(values=c(0:6))+
  geom_text(data=temp, aes(x=1.5, y=id+0.3, label=paste0(id, " - ", linetype)), family="A", size=4.5)+
  theme_void()
```

在 R 語言中顏色的設定可以直接輸入預設的顏色名稱，詳列如圖\@ref(fig:geom-setting-color)，抑或直接透過十六進位值色碼，請參考[色碼表](https://www.ifreesite.com/color/)。

<H2 id="geom-setting-color"></H2>
```{r geom-setting-color, echo=F, eval=T, out.width="90%", fig.align="center", fig.cap="顏色代碼"}
temp=data.frame(color=grDevices::colors())%>%
  filter(!grepl("[0-9]", color))%>%
  mutate(id=c(1:nrow(.)))%>%
  mutate(x=(id-1)%%6+1, y=floor(nrow(.)/6)-(id-1)%/%6+1,
         seq=paste0(str_pad(x, 2, "left", 0), "-", str_pad(y, 2, "left", 0)))%>%
  arrange(seq)
temp=cbind(temp, data.frame(t(col2rgb(temp$color))))%>%
  mutate(Luminance=0.2126*red+0.7152*green+0.0722*blue,
         fontcolor=ifelse(Luminance>100, "black", "white"))
ggplot(temp, aes(x=x, y=y, fill=color)) +
  geom_tile(show.legend=F)+
  scale_fill_manual(limits=temp$color, values=temp$color)+
  geom_text(aes(label=color, color=fontcolor), family="A", size=2.5, show.legend=F)+
  scale_color_manual(values=c("black"="black", "white"="white"))+
  theme_void()
```

有了上述對於圖表的基本認識後，接下來就讓我們用各種不同資料與案例說明各圖表的功能及程式撰寫方式。


### 散布圖
散布圖（Scatter Plot）應用於表達兩個連續變數之間的關係，橫軸與縱軸分別代表不同的連續變數，並利用點表示此二連續變數在二維空間的分布，可利用`geom_point()`函式達成之，函式撰寫架構如下。

```{r geom-point-code, echo=T, eval=F}
geom_point(color=, shape=, size=, stroke=, fill=, alpha=)
```

以上各引數的功能彙整如表\@ref(tab:geom-point-code-tab)。

```{r geom-point-code-tab, echo=F, eval=T}
gp_code=data.frame(argument=c("`color=`","`shape=`","`size=`","`stroke=`","`fill=`","`alpha=`"),
                   setting=c("設定點的顏色","設定點的形狀","設定點的大小","設定點外圍框線的粗細","設定點內部的顏色","設定點的透明度"), explain=c("請參考<A href='#geom-setting-color'>顏色設定</A>","請參考<A href='#geom-setting-shape'>形狀設定</A>","數值","數值，僅有空心形狀者（如<A href='#geom-setting-shape'>形狀設定</A>為 21~25 者）尚有效","請參考<A href='#geom-setting-color'>顏色設定</A>，僅有空心形狀者（如<A href='#geom-setting-shape'>形狀設定</A>為 21~25 者）尚有效","數值，介於 0（完全透明）與 1（完全不透明）間"))

kable(gp_code, booktabs=T, escape=F, caption="`geom_point()`函式引數設定", col.names=c("引數","功能設定","說明"))%>%
  kable_styling(bootstrap_options=c("striped", "hover"), font_size=14)%>%
  row_spec(0, bold=T, color="white", background="#8E8E8E")
```


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 基礎散布圖**</p>  
以`iris`資料為例，以花萼的長度（Sepal.Length）為橫軸，花萼的寬度（Sepal.Width）為縱軸，繪製散布圖，程式碼撰寫如下。

```{r geom-point-eg1, echo=T, eval=T, out.width="70%", fig.align="center"}
ggplot(iris, aes(x=Sepal.Length, Sepal.Width))+
  geom_point()
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 修正散布圖樣式**</p>  
若希望更動點的樣式，可利用表\@ref(tab:geom-point-code-tab)的引數控制之。

```{r geom-point-eg2, echo=T, eval=T, out.width="70%", fig.align="center"}
ggplot(iris, aes(x=Sepal.Length, Sepal.Width))+
  geom_point(color="red", shape=23, size=3, stroke=1, fill="#AE57A4", alpha=0.5)
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 漸層樣式散布圖**</p>  
散布圖一般而言僅能表示二維的數據，且大多是連續變數，然而若能在點子上給定顏色或大小，則可進一步顯示更多維度的資料。漸層樣式散布圖中，須**依據資料隨之變動**的樣式，其引數設定亦須置於<A href="#ggplot-aes">`aes()`</A>函式**內**；反之，若樣式不會隨資料變動，則須放置於<A href="#ggplot-aes">`aes()`</A>函式**外**。

承繼上述案例，若希望用顏色表示品種（Species），並以點子的大小表示花瓣的長度（Petal.Width），而點子的形狀皆固定為圓點（引數需置於<A href="#ggplot-aes">`aes()`</A>函式**外**），程式碼撰寫如下。

```{r geom-point-eg3, echo=T, eval=T, out.width="70%", fig.align="center"}
ggplot(iris, aes(x=Sepal.Length, Sepal.Width))+
  geom_point(aes(color=Species, size=Petal.Width), shape=20)
```

圖中「品種」為類別型資料；「花瓣的寬度」為連續型資料，透過漸層樣式散布圖可表達更多維度的資料，添增資訊的豐富度。觀察出圖結果可發現，setosa 類別（ <span style="color:#F8766D">紅色點子</span>）的花瓣寬度（點子大小）與花萼長度（橫軸）相較於另兩品種偏小，有相當明顯的區別。因此透過漸層樣式散布圖可初步觀察對於資料分類的重要影響變數，為資料科學的關鍵步驟。

若希望修正顏色漸層，請參考[此](#顏色漸層)；若希望修正點子大小之漸層，請參考[此](#大小尺度)。

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 加入趨勢線**</p>  
點子圖通常用以表示兩連續變數的關係，可從中推敲其趨勢，繪圖時可另考量繪製趨勢線，有助於引導閱讀者瞭解變數間的關係。趨勢線可透過`geom_smooth()`繪製，函式撰寫如下。

```{r geom-smooth-code, echo=T, eval=F}
geom_smooth(method, se=, span=, level=, color=, linetype=, linewidth=, fill=, alpha=)
```

以上各引數的功能彙整如表\@ref(tab:geom-smooth-code-tab)。

```{r geom-smooth-code-tab, echo=F, eval=T}
gs_code=data.frame(argument=c("`method=`","`formula=`","`se=`","`level=`","`span=`","`color=`","`linetype=`","`linewidth=`","`fill=`","`alpha=`"),
                   setting=c("設定趨勢線迴歸模型","設定迴歸函式","設定是否回傳趨勢線的標準誤","設定信心水準","設定迴歸的區間","設定趨勢線顏色","設定趨勢線樣式","設定趨勢線粗細","設定趨勢線標準誤範圍的顏色","設定趨勢線標準誤範圍的透明度"), explain=c("可使用線性迴歸（`lm`）或一般化線性迴歸（`glm`）","預設為`y~x`","預設為`T`，若不希望有標準誤，須設定`F`","預設為 95% (`0.95`) 之信心水準","迴歸區間，若區間愈大，線條愈平滑；若區間愈小，線條愈趨近原資料分布","請參考<A href='#geom-setting-color'>顏色設定</A>","請參考<A href='#geom-setting-linetype'>線條樣式設定</A>","數值","請參考<A href='#geom-setting-color'>顏色設定</A>","數值，介於 0（完全透明）與 1（完全不透明）間"))

kable(gs_code, booktabs=T, escape=F, caption="`geom_smooth()`函式引數設定", col.names=c("引數","功能設定","說明"))%>%
  kable_styling(bootstrap_options=c("striped", "hover"), font_size=14)%>%
  column_spec(2, width="6.5cm")%>%
  row_spec(0, bold=T, color="white", background="#8E8E8E")
```

以加入線性的趨勢線為例，此時`method=`引數設定為`lm`，即線性迴歸（linear model），而公式則為$y=\beta x$（`y~x`），程式碼撰寫如下。另請注意在線性迴歸時，即無須另設定用於曲線的`span=`引數。

```{r geom-smooth-eg1, echo=T, eval=T, out.width="70%", fig.align="center"}
ggplot(iris, aes(x=Sepal.Length, Sepal.Width))+
  geom_point()+
  geom_smooth(method=lm, formula=y~x, color="#CE0000", fill="#FF7575", alpha=0.2)
```

不同的`span=`引數所繪製的趨勢圖亦有所不同，如圖\@ref(fig:geom-smooth-eg2)所示，可發現當所設定的數值愈大時，趨勢線愈加平滑。

```{r geom-smooth-eg2, echo=F, eval=T, out.width="90%", fig.align="center", fig.cap="趨勢線中的`span=`引數", warning=F, message=F}
plot_list=list()
all_span=c(0.2,0.5,0.8,1,1.5,2)
for(i in c(1:length(all_span))){
 temp=ggplot(iris, aes(x=Sepal.Length, Sepal.Width))+
   geom_point()+
   geom_smooth(color="#CE0000", fill="#FF7575", alpha=0.2, span=all_span[i])+
   labs(title=paste0("<span style='font-family: B;'>span=", all_span[i], "</span>"))+
   theme(plot.title=element_markdown(hjust=0.5, fill="#F0F0F0", padding=margin(0,5,0,0, unit="pt")))
 plot_list[[i]]=temp
}
theme1=theme(axis.text.y=element_blank(),
             axis.ticks.y=element_blank(),
             axis.title.y=element_blank())
theme2=theme(axis.text.x=element_blank(),
             axis.ticks.x=element_blank(),
             axis.title.x=element_blank())
theme3=theme(axis.text=element_blank(),
             axis.ticks=element_blank(),
             axis.title=element_blank())
cowplot::plot_grid(plot_list[[1]]+theme2, plot_list[[2]]+theme3, plot_list[[3]]+theme3, plot_list[[4]], plot_list[[5]]+theme1, plot_list[[6]]+theme1, align="hv", ncol=3)
```


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 加入跳點**</p>  
有時資料點會重疊，導致肉眼無法觀察，更難以判斷資料的集中程度（重疊後變成單一點，反而會將群聚的點誤判為稀疏），此一情境即常發生於具有整數或類別型的資料。如以下案例，利用`mpg`資料，以汽缸數（cyl）為橫軸；以每加侖英里數（hwy）為縱軸，繪製散布圖如下。

```{r geom-point-eg4, echo=T, eval=T, out.width="70%", fig.align="center"}
ggplot(mpg, aes(cyl, hwy))+
  geom_point()
```

由於汽缸數與每加侖英里數在該資料中皆為正整數，導致有許多資料是重疊的，不易觀察。此時可以利用`geom_jitter()`加入亂數，使資料跳動至鄰近的座標點上，得以較明確觀察資料間的散布情形，且不影響原資料的分布。`geom_jitter()`函式的撰寫架構如下。

```{r geom-jitter-code, echo=T, eval=F}
geom_jitter(width=, height=)
```

其中，`width=`引數表示橫軸變動的幅度，如`width=0.1`，表示針對橫軸向左與右隨機變動 10% 以內。`height=`引數則表示橫軸變動的幅度。

另外`geom_point()`內部的所有引數皆可套用至`geom_jitter()`函式中，如需設定顏色、大小等，皆可使用表\@ref(tab:geom-point-code-tab)的引數。

```{r geom-jitter-eg, echo=T, eval=T, out.width="70%", fig.align="center"}
# 先利用duplicated()函式檢查重複資料的筆數
sum(duplicated(mpg[, c("cyl","hwy")]))

# 繪製具有跳點的散布圖
ggplot(mpg, aes(cyl, hwy))+
  geom_jitter(width=0.2, height=0.2)
```

由出圖結果可知，使用`geom_jitter()`可使資料更容易辨識，惟須注意的是，`width=`與`height=`引數對於圖表的視覺化程度有相當大的影響，若數值設定的愈大，資料連續性的情況就會越明顯，但可能過度偏離實際情況。因此針對不同資料，此二引數的調整需多次嘗試，尋找最佳可視化且不影響原始資料分布的繪圖方式。此外，由於`geom_jitter()`的跳動是隨機的，若欲每次輸出的結果是相同的，可設定隨機亂數（[`set.seed()`](https://r-coder.com/set-seed-r/)）在每次繪圖前執行之，以確保使用相同的隨機種子。


### 折線圖
折線圖（Line Chart）應用於表達兩連續變數的趨勢，或一連續變數隨時間變化的趨勢，可利用`geom_line()`函式達成之，函式撰寫架構如下。

```{r geom-line-code, echo=T, eval=F}
geom_line(color=, linetype=, linewidth=, alpha=, group=)
```

函式中各引數的功能彙整如表\@ref(tab:geom-line-code-tab)。

```{r geom-line-code-tab, echo=F, eval=T}
gl_code=data.frame(argument=c("`color=`","`linetype=`","`linewidth=`","`alpha=`","`group=`"),
                   setting=c("設定線條的顏色","設定線條樣式","設定線條的粗細","設定線條的透明度","設定線條的分群"), explain=c("請參考<A href='#geom-setting-color'>顏色設定</A>","請參考<A href='#geom-setting-linetype'>線條樣式設定</A>","數值","數值，介於 0（完全透明）與 1（完全不透明）間","分群欄位名稱（若設定為 1，表示將資料全部連成一折線）"))

kable(gl_code, booktabs=T, escape=F, caption="`geom_line()`函式引數設定", col.names=c("引數","功能設定","說明"))%>%
  kable_styling(bootstrap_options=c("striped", "hover"), font_size=14)%>%
  row_spec(0, bold=T, color="white", background="#8E8E8E")
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 基礎折線圖**</p>  

以`airquality`（空氣品質）資料為例，以日期（Month & Day）為橫軸，溫度（Temp）為縱軸，繪製折線圖，程式碼撰寫如下。其中利用[`as.Date()`](#日期與時間)函式建立日期資料，並透過[`str_pad()`](#文字處理)函式建立相同長度的文字。而在`geom_line()`函式中必須設定`group=1`之引數，用以表達將所有資料連貫為一條折線。

```{r geom-line-eg1, echo=T, eval=T, out.width="70%", fig.align="center"}
# 先處理airquality資料(建立日期)
airquality_new=airquality
airquality_new$Date=as.Date(paste0(str_pad(airquality_new$Month, 2, "left", 0), "-", str_pad(airquality_new$Day, 2, "left", 0)), format="%m-%d")

ggplot(data=airquality_new, aes(x=Date, y=Temp))+
  geom_line(group=1, color="red")
```

圖中的橫軸為日期資料，而若欲修正時間軸的日期顯示方式，請參考[此](#座標軸尺度)。

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 多線折線圖**</p>  
以上的折線圖僅顯示單一條線，而有時我們希望在同一張圖表達多條折線，可藉此必較不同區間的資料，此時必須在`geom_line()`函式中設定`group=`函數為指定的分群欄位。

再次以`airquality`（空氣品質）資料為例，若希望根據月份繪製不同折線，並給定不同顏色，此時`group=`引數即須設定為「Month」，並置於<A href="#ggplot-aes">`aes()`</A>函式中，表示須根據不同類別而使設定有所更動者。由於不同折線將賦予不同顏色，故`color=`引數必須置於<A href="#ggplot-aes">`aes()`</A>函式內。最後，若折線的粗細為一固定值，則必須將`linewidth=`引數置於<A href="#ggplot-aes">`aes()`</A>函式外。根據上述繪圖邏輯，程式碼撰寫如下。

```{r geom-line-eg2, echo=T, eval=T, out.width="70%", fig.align="center"}
ggplot(data=airquality, aes(x=Day, y=Temp))+
  geom_line(aes(group=Month, color=as.factor(Month)), linewidth=1)
```


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 折線圖與散布圖疊合**</p>  
通常表達數據的趨勢，除了使用折線圖外，為了使資料的座標更為清晰，會另將散布圖疊在其上，以`airquality`資料為例，程式碼撰寫如下。程式碼中另將不同月份賦予不同點子的形狀，故此時`geom_point()`函式中的`shape=`引數亦須放置於<A href="#ggplot-aes">`aes()`</A>函式內。而點子的大小不會因為不同月份而有所變動，在圖表中皆為固定者，故須置於<A href="#ggplot-aes">`aes()`</A>函式外。

```{r geom-line-eg3, echo=T, eval=T, out.width="70%", fig.align="center"}
ggplot(data=airquality, aes(x=Day, y=Temp))+
  geom_line(aes(group=Month, color=as.factor(Month)), linewidth=1)+
  geom_point(aes(group=Month, color=as.factor(Month), shape=as.factor(Month)), size=2)
```



### 長條圖



### 直方圖



### 密度圖


### 圓餅圖


### 盒狀圖


### 小提琴圖


### 氣泡圖



### 山脊圖



### 熱力圖


### 矩形式樹狀圖


### 桑基圖


### 雷達圖


### 三元圖



### 直線、曲線與線段




## 繪圖設定

### 尺度設定

#### 顏色漸層

#### 大小尺度

#### 粗細尺度

#### 座標軸尺度




### 主題設定

#### 主題模板


#### 圖例設定


#### 圖軸設定


## 圖表文字與插圖
<!-- geom_text() -->
<!-- geom_label() -->
<!-- ggtext -->
<!-- ggrepel -->
<!-- ggimage -->


### 標註文字

### 標註標籤


### 標註圖片


## 其他應用

### 合併多圖

### GIF 繪製







