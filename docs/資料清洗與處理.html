<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 資料清洗與處理 | 運輸資料分析角落：初學者園地</title>
  <meta name="description" content="運輸資料分析" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 資料清洗與處理 | 運輸資料分析角落：初學者園地" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="運輸資料分析" />
  <meta name="github-repo" content="ChiaJung-Yeh/Transport-Analysis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 資料清洗與處理 | 運輸資料分析角落：初學者園地" />
  
  <meta name="twitter:description" content="運輸資料分析" />
  

<meta name="author" content="Chia-Jung (Robert) Yeh 葉家榮 PhD: Insitute of Transport and Logistics Studies, USYD M.S.: Department of Transportation and Logistics Management, NYCU" />


<meta name="date" content="2024-02-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="r-語言基礎語法.html"/>
<link rel="next" href="資料視覺化.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.28/datatables.js"></script>
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
<link rel="stylesheet" href="stylebox.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">運輸資料分析角落：初學者園地</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><strong>前言</strong></a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#簡介與目錄"><i class="fa fa-check"></i>簡介與目錄</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#資料分析心法"><i class="fa fa-check"></i>資料分析心法</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#安裝套件"><i class="fa fa-check"></i>安裝套件</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#其他參考資料"><i class="fa fa-check"></i>其他參考資料</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html"><i class="fa fa-check"></i><b>1</b> <strong>R 語言基礎語法</strong></a>
<ul>
<li class="chapter" data-level="1.1" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#物件object"><i class="fa fa-check"></i><b>1.1</b> 物件（Object）</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#向量vector"><i class="fa fa-check"></i><b>1.1.1</b> 向量（Vector）</a></li>
<li class="chapter" data-level="1.1.2" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#因子factor"><i class="fa fa-check"></i><b>1.1.2</b> 因子（Factor）</a></li>
<li class="chapter" data-level="1.1.3" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#矩陣matrix"><i class="fa fa-check"></i><b>1.1.3</b> 矩陣（Matrix）</a></li>
<li class="chapter" data-level="1.1.4" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#資料框data-frame"><i class="fa fa-check"></i><b>1.1.4</b> 資料框（Data Frame）</a></li>
<li class="chapter" data-level="1.1.5" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#陣列list"><i class="fa fa-check"></i><b>1.1.5</b> 陣列（List）</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#文字處理"><i class="fa fa-check"></i><b>1.2</b> 文字處理</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#連接字串"><i class="fa fa-check"></i><b>1.2.1</b> 連接字串</a></li>
<li class="chapter" data-level="1.2.2" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#轉換大小寫"><i class="fa fa-check"></i><b>1.2.2</b> 轉換大小寫</a></li>
<li class="chapter" data-level="1.2.3" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#擷取與取代字元"><i class="fa fa-check"></i><b>1.2.3</b> 擷取與取代字元</a></li>
<li class="chapter" data-level="1.2.4" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#拆解字串"><i class="fa fa-check"></i><b>1.2.4</b> 拆解字串</a></li>
<li class="chapter" data-level="1.2.5" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#計算字元數"><i class="fa fa-check"></i><b>1.2.5</b> 計算字元數</a></li>
<li class="chapter" data-level="1.2.6" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#搜尋字元"><i class="fa fa-check"></i><b>1.2.6</b> 搜尋字元</a></li>
<li class="chapter" data-level="1.2.7" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#文字填補"><i class="fa fa-check"></i><b>1.2.7</b> 文字填補</a></li>
<li class="chapter" data-level="1.2.8" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#文字排序"><i class="fa fa-check"></i><b>1.2.8</b> 文字排序</a></li>
<li class="chapter" data-level="1.2.9" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#正規表示式"><i class="fa fa-check"></i><b>1.2.9</b> 正規表示式</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#控制流程"><i class="fa fa-check"></i><b>1.3</b> 控制流程</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#邏輯判斷"><i class="fa fa-check"></i><b>1.3.1</b> 邏輯判斷</a></li>
<li class="chapter" data-level="1.3.2" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#for迴圈"><i class="fa fa-check"></i><b>1.3.2</b> <code>for()</code>迴圈</a></li>
<li class="chapter" data-level="1.3.3" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#while迴圈"><i class="fa fa-check"></i><b>1.3.3</b> <code>while()</code>迴圈</a></li>
<li class="chapter" data-level="1.3.4" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#建立自定義函式"><i class="fa fa-check"></i><b>1.3.4</b> 建立自定義函式</a></li>
<li class="chapter" data-level="1.3.5" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#錯誤處理"><i class="fa fa-check"></i><b>1.3.5</b> 錯誤處理</a></li>
<li class="chapter" data-level="1.3.6" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#apply函式家族"><i class="fa fa-check"></i><b>1.3.6</b> <code>apply</code>函式家族</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#資料讀取與匯出"><i class="fa fa-check"></i><b>1.4</b> 資料讀取與匯出</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#csv-與-txt-檔"><i class="fa fa-check"></i><b>1.4.1</b> CSV 與 TXT 檔</a></li>
<li class="chapter" data-level="1.4.2" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#json-檔"><i class="fa fa-check"></i><b>1.4.2</b> JSON 檔</a></li>
<li class="chapter" data-level="1.4.3" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#xml-檔案"><i class="fa fa-check"></i><b>1.4.3</b> XML 檔案</a></li>
<li class="chapter" data-level="1.4.4" data-path="r-語言基礎語法.html"><a href="r-語言基礎語法.html#資料來源"><i class="fa fa-check"></i><b>1.4.4</b> 資料來源</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html"><i class="fa fa-check"></i><b>2</b> <strong>資料清洗與處理</strong></a>
<ul>
<li class="chapter" data-level="2.1" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#data.frame-與-data.table"><i class="fa fa-check"></i><b>2.1</b> data.frame 與 data.table</a></li>
<li class="chapter" data-level="2.2" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#合併資料"><i class="fa fa-check"></i><b>2.2</b> 合併資料</a></li>
<li class="chapter" data-level="2.3" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#選取資料欄位"><i class="fa fa-check"></i><b>2.3</b> 選取資料欄位</a></li>
<li class="chapter" data-level="2.4" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#依條件篩選資料"><i class="fa fa-check"></i><b>2.4</b> 依條件篩選資料</a></li>
<li class="chapter" data-level="2.5" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#新增資料屬性"><i class="fa fa-check"></i><b>2.5</b> 新增資料屬性</a></li>
<li class="chapter" data-level="2.6" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#條件判斷"><i class="fa fa-check"></i><b>2.6</b> 條件判斷</a></li>
<li class="chapter" data-level="2.7" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#資料排序"><i class="fa fa-check"></i><b>2.7</b> 資料排序</a></li>
<li class="chapter" data-level="2.8" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#資料分群與統計"><i class="fa fa-check"></i><b>2.8</b> 資料分群與統計</a></li>
<li class="chapter" data-level="2.9" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#連接資料"><i class="fa fa-check"></i><b>2.9</b> 連接資料</a></li>
<li class="chapter" data-level="2.10" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#重新命名欄位"><i class="fa fa-check"></i><b>2.10</b> 重新命名欄位</a></li>
<li class="chapter" data-level="2.11" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#去除重複資料"><i class="fa fa-check"></i><b>2.11</b> 去除重複資料</a></li>
<li class="chapter" data-level="2.12" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#資料集合"><i class="fa fa-check"></i><b>2.12</b> 資料集合</a></li>
<li class="chapter" data-level="2.13" data-path="資料清洗與處理.html"><a href="資料清洗與處理.html#資料型態轉換"><i class="fa fa-check"></i><b>2.13</b> 資料型態轉換</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="資料視覺化.html"><a href="資料視覺化.html"><i class="fa fa-check"></i><b>3</b> <strong>資料視覺化</strong></a>
<ul>
<li class="chapter" data-level="3.1" data-path="資料視覺化.html"><a href="資料視覺化.html#圖表繪製"><i class="fa fa-check"></i><b>3.1</b> 圖表繪製</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="資料視覺化.html"><a href="資料視覺化.html#直線曲線與線段"><i class="fa fa-check"></i><b>3.1.1</b> 直線、曲線與線段</a></li>
<li class="chapter" data-level="3.1.2" data-path="資料視覺化.html"><a href="資料視覺化.html#直方圖"><i class="fa fa-check"></i><b>3.1.2</b> 直方圖</a></li>
<li class="chapter" data-level="3.1.3" data-path="資料視覺化.html"><a href="資料視覺化.html#長條圖"><i class="fa fa-check"></i><b>3.1.3</b> 長條圖</a></li>
<li class="chapter" data-level="3.1.4" data-path="資料視覺化.html"><a href="資料視覺化.html#折線圖"><i class="fa fa-check"></i><b>3.1.4</b> 折線圖</a></li>
<li class="chapter" data-level="3.1.5" data-path="資料視覺化.html"><a href="資料視覺化.html#山脊圖"><i class="fa fa-check"></i><b>3.1.5</b> 山脊圖</a></li>
<li class="chapter" data-level="3.1.6" data-path="資料視覺化.html"><a href="資料視覺化.html#密度圖"><i class="fa fa-check"></i><b>3.1.6</b> 密度圖</a></li>
<li class="chapter" data-level="3.1.7" data-path="資料視覺化.html"><a href="資料視覺化.html#點子圖"><i class="fa fa-check"></i><b>3.1.7</b> 點子圖</a></li>
<li class="chapter" data-level="3.1.8" data-path="資料視覺化.html"><a href="資料視覺化.html#氣泡圖"><i class="fa fa-check"></i><b>3.1.8</b> 氣泡圖</a></li>
<li class="chapter" data-level="3.1.9" data-path="資料視覺化.html"><a href="資料視覺化.html#圓餅圖"><i class="fa fa-check"></i><b>3.1.9</b> 圓餅圖</a></li>
<li class="chapter" data-level="3.1.10" data-path="資料視覺化.html"><a href="資料視覺化.html#盒狀圖"><i class="fa fa-check"></i><b>3.1.10</b> 盒狀圖</a></li>
<li class="chapter" data-level="3.1.11" data-path="資料視覺化.html"><a href="資料視覺化.html#小提琴圖"><i class="fa fa-check"></i><b>3.1.11</b> 小提琴圖</a></li>
<li class="chapter" data-level="3.1.12" data-path="資料視覺化.html"><a href="資料視覺化.html#熱力圖"><i class="fa fa-check"></i><b>3.1.12</b> 熱力圖</a></li>
<li class="chapter" data-level="3.1.13" data-path="資料視覺化.html"><a href="資料視覺化.html#矩形式樹狀圖"><i class="fa fa-check"></i><b>3.1.13</b> 矩形式樹狀圖</a></li>
<li class="chapter" data-level="3.1.14" data-path="資料視覺化.html"><a href="資料視覺化.html#桑基圖"><i class="fa fa-check"></i><b>3.1.14</b> 桑基圖</a></li>
<li class="chapter" data-level="3.1.15" data-path="資料視覺化.html"><a href="資料視覺化.html#雷達圖"><i class="fa fa-check"></i><b>3.1.15</b> 雷達圖</a></li>
<li class="chapter" data-level="3.1.16" data-path="資料視覺化.html"><a href="資料視覺化.html#三元圖"><i class="fa fa-check"></i><b>3.1.16</b> 三元圖</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="資料視覺化.html"><a href="資料視覺化.html#繪圖設定"><i class="fa fa-check"></i><b>3.2</b> 繪圖設定</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="資料視覺化.html"><a href="資料視覺化.html#尺度設定"><i class="fa fa-check"></i><b>3.2.1</b> 尺度設定</a></li>
<li class="chapter" data-level="3.2.2" data-path="資料視覺化.html"><a href="資料視覺化.html#主題設定"><i class="fa fa-check"></i><b>3.2.2</b> 主題設定</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="資料視覺化.html"><a href="資料視覺化.html#圖表文字與插圖"><i class="fa fa-check"></i><b>3.3</b> 圖表文字與插圖</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="資料視覺化.html"><a href="資料視覺化.html#標註文字"><i class="fa fa-check"></i><b>3.3.1</b> 標註文字</a></li>
<li class="chapter" data-level="3.3.2" data-path="資料視覺化.html"><a href="資料視覺化.html#標註標籤"><i class="fa fa-check"></i><b>3.3.2</b> 標註標籤</a></li>
<li class="chapter" data-level="3.3.3" data-path="資料視覺化.html"><a href="資料視覺化.html#標註圖片"><i class="fa fa-check"></i><b>3.3.3</b> 標註圖片</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="資料視覺化.html"><a href="資料視覺化.html#其他應用"><i class="fa fa-check"></i><b>3.4</b> 其他應用</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="資料視覺化.html"><a href="資料視覺化.html#合併多圖"><i class="fa fa-check"></i><b>3.4.1</b> 合併多圖</a></li>
<li class="chapter" data-level="3.4.2" data-path="資料視覺化.html"><a href="資料視覺化.html#gif-繪製"><i class="fa fa-check"></i><b>3.4.2</b> GIF 繪製</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="基本資料統計.html"><a href="基本資料統計.html"><i class="fa fa-check"></i><b>4</b> <strong>基本資料統計</strong></a>
<ul>
<li class="chapter" data-level="4.1" data-path="基本資料統計.html"><a href="基本資料統計.html#公車資料統計分析"><i class="fa fa-check"></i><b>4.1</b> 公車資料統計分析</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="基本資料統計.html"><a href="基本資料統計.html#路線統計分析"><i class="fa fa-check"></i><b>4.1.1</b> 路線統計分析</a></li>
<li class="chapter" data-level="4.1.2" data-path="基本資料統計.html"><a href="基本資料統計.html#站牌統計分析"><i class="fa fa-check"></i><b>4.1.2</b> 站牌統計分析</a></li>
<li class="chapter" data-level="4.1.3" data-path="基本資料統計.html"><a href="基本資料統計.html#站間行駛距離計算"><i class="fa fa-check"></i><b>4.1.3</b> 站間行駛距離計算</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://www.sydney.edu.au/business/about/our-people/research-students/chia-jung-yeh-557.html" target="blank">葉家榮 Chia-Jung Yeh</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">運輸資料分析角落：初學者園地</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="資料清洗與處理" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> <strong>資料清洗與處理</strong><a href="資料清洗與處理.html#資料清洗與處理" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>資料清洗與處理是分析前的第一步，透過此一步驟可初步觀察資料的趨勢，並以圖表呈現敘述統計結果。此外，在經過完善的資料整理後，尚能進一步建構統計模型或數據分析工具以瞭解資料背後所衍伸之意涵。<code>dplyr</code>與<code>data.table</code>套件是 R 語言中兩大最常見的資料處理工具，請務必安裝並導入該套件。</p>
<p>資料清洗與處理常用之套件與函式彙整如表<a href="資料清洗與處理.html#tab:function-data-clean">2.1</a>。</p>
<table class="table table-striped table-hover" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:function-data-clean">表 2.1: </span>資料處理重要函式
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: #8E8E8E !important;">
套件
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: #8E8E8E !important;">
函式
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: #8E8E8E !important;">
功能
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>base</code>
</td>
<td style="text-align:left;">
<a href="資料清洗與處理.html#連接資料"><code>merge()</code></a>
</td>
<td style="text-align:left;">
根據指定欄位連接兩資料
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: middle !important;" rowspan="22">
<code>dplyr</code>
</td>
<td style="text-align:left;">
<a href="資料清洗與處理.html#合併資料"><code>bind_rows()</code></a>
</td>
<td style="text-align:left;">
合併橫列
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#合併資料"><code>bind_cols()</code></a>
</td>
<td style="text-align:left;">
合併直行
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#選取資料欄位"><code>select()</code></a>
</td>
<td style="text-align:left;">
選取特定欄位
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#依條件篩選資料"><code>filter()</code></a>
</td>
<td style="text-align:left;">
根據條件篩選資料
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#新增資料屬性"><code>mutate()</code></a>
</td>
<td style="text-align:left;">
新增資料屬性（直行）
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料分群與統計"><code>group_by()</code></a>
</td>
<td style="text-align:left;">
將資料依據特定欄位分群
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料分群與統計"><code>summarise()</code></a>
</td>
<td style="text-align:left;">
將分群的資料予以計算
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料分群與統計"><code>reframe()</code></a>
</td>
<td style="text-align:left;">
將分群的資料予以計算
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料分群與統計"><code>slice()</code></a>
</td>
<td style="text-align:left;">
依據分群擷取特定資料
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#連接資料"><code>left_join()</code></a>
</td>
<td style="text-align:left;">
根據指定欄位連接兩資料（僅保留左側資料）
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#連接資料"><code>inner_join()</code></a>
</td>
<td style="text-align:left;">
根據指定欄位連接兩資料（擁有的資料皆須保留）
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#連接資料"><code>full_join()</code></a>
</td>
<td style="text-align:left;">
根據指定欄位連接兩資料（僅保留共同擁有的資料）
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料排序"><code>arrange()</code></a>
</td>
<td style="text-align:left;">
根據指定欄位將資料排序
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#重新命名欄位"><code>rename()</code></a>
</td>
<td style="text-align:left;">
更改欄位名稱
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#去除重複資料"><code>distinct()</code></a>
</td>
<td style="text-align:left;">
去除重複資料
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料集合"><code>intersect()</code></a>
</td>
<td style="text-align:left;">
尋找兩資料中共同擁有的資料列（交集）
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料集合"><code>union()</code></a>
</td>
<td style="text-align:left;">
保留所有擁有的資料列（聯集，去除重複者）
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料集合"><code>union_all()</code></a>
</td>
<td style="text-align:left;">
保留所有擁有的資料列（聯集，保留重複者）
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料集合"><code>setdiff()</code></a>
</td>
<td style="text-align:left;">
尋找唯獨左側資料擁有的資料列（差集）
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料集合"><code>symdiff()</code></a>
</td>
<td style="text-align:left;">
尋找唯獨其中一份資料擁有的資料列（互斥）
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料集合"><code>setequal()</code></a>
</td>
<td style="text-align:left;">
檢查兩資料是否完全相同（無論排序）
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#條件判斷"><code>case_when()</code></a>
</td>
<td style="text-align:left;">
條件判斷
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: middle !important;" rowspan="6">
<code>data.table</code>
</td>
<td style="text-align:left;">
<a href="資料清洗與處理.html#data.frame-與-data.table"><code>setDT()</code></a>
</td>
<td style="text-align:left;">
將資料轉換為<code>data.table</code>形式
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#data.frame-與-data.table"><code>setkey()</code></a>
</td>
<td style="text-align:left;">
設定<code>data.table</code>資料的主鍵
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#合併資料"><code>rbindlist()</code></a>
</td>
<td style="text-align:left;">
合併陣列中的所有資料
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#連接資料"><code>merge.data.table()</code></a>
</td>
<td style="text-align:left;">
根據指定欄位連接兩資料
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料型態轉換"><code>dcast()</code></a>
</td>
<td style="text-align:left;">
轉換長資料為寬資料
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="資料清洗與處理.html#資料型態轉換"><code>melt()</code></a>
</td>
<td style="text-align:left;">
轉換寬資料為長資料
</td>
</tr>
</tbody>
</table>
<p>為展示「資料清洗與處理」過程，後續範例中我們會使用的資料如下，請先讀取之。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="資料清洗與處理.html#cb1-1" tabindex="-1"></a><span class="co"># 世界國家資料</span></span>
<span id="cb1-2"><a href="資料清洗與處理.html#cb1-2" tabindex="-1"></a>world<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ChiaJung-Yeh/Transport-Analysis/master/Data/world.csv&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ac55f6b4bc99d7fe7bdd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac55f6b4bc99d7fe7bdd">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177"],["FJ","TZ","EH","CA","US","KZ","UZ","PG","ID","AR","CL","CD","SO","KE","SD","TD","HT","DO","RU","BS","FK","NO","GL","TF","TL","ZA","LS","MX","UY","BR","BO","PE","CO","PA","CR","NI","HN","SV","GT","BZ","VE","GY","SR","FR","EC","PR","JM","CU","ZW","BW",null,"SN","ML","MR","BJ","NE","NG","CM","TG","GH","CI","GN","GW","LR","SL","BF","CF","CG","GA","GQ","ZM","MW","MZ","SZ","AO","BI","IL","LB","MG","PS","GM","TN","DZ","JO","AE","QA","KW","IQ","OM","VU","KH","TH","LA","MM","VN","KP","KR","MN","IN","BD","BT","NP","PK","AF","TJ","KG","TM","IR","SY","AM","SE","BY","UA","PL","AT","HU","MD","RO","LT","LV","EE","DE","BG","GR","TR","AL","HR","CH","LU","BE","NL","PT","ES","IE","NC","SB","NZ","AU","LK","CN","TW","IT","DK","GB","IS","AZ","GE","PH","MY","BN","SI","FI","SK","CZ","ER","JP","PY","YE","SA","AQ",null,"CY","MA","EG","LY","ET","DJ",null,"UG","RW","BA","MK","RS","ME","XK","TT","SS"],["Fiji","Tanzania","Western Sahara","Canada","United States","Kazakhstan","Uzbekistan","Papua New Guinea","Indonesia","Argentina","Chile","Democratic Republic of the Congo","Somalia","Kenya","Sudan","Chad","Haiti","Dominican Republic","Russian Federation","Bahamas","Falkland Islands","Norway","Greenland","French Southern and Antarctic Lands","Timor-Leste","South Africa","Lesotho","Mexico","Uruguay","Brazil","Bolivia","Peru","Colombia","Panama","Costa Rica","Nicaragua","Honduras","El Salvador","Guatemala","Belize","Venezuela","Guyana","Suriname","France","Ecuador","Puerto Rico","Jamaica","Cuba","Zimbabwe","Botswana","Namibia","Senegal","Mali","Mauritania","Benin","Niger","Nigeria","Cameroon","Togo","Ghana","Cote d'Ivoire","Guinea","Guinea-Bissau","Liberia","Sierra Leone","Burkina Faso","Central African Republic","Republic of the Congo","Gabon","Equatorial Guinea","Zambia","Malawi","Mozambique","eSwatini","Angola","Burundi","Israel","Lebanon","Madagascar","Palestine","The Gambia","Tunisia","Algeria","Jordan","United Arab Emirates","Qatar","Kuwait","Iraq","Oman","Vanuatu","Cambodia","Thailand","Lao PDR","Myanmar","Vietnam","Dem. Rep. Korea","Republic of Korea","Mongolia","India","Bangladesh","Bhutan","Nepal","Pakistan","Afghanistan","Tajikistan","Kyrgyzstan","Turkmenistan","Iran","Syria","Armenia","Sweden","Belarus","Ukraine","Poland","Austria","Hungary","Moldova","Romania","Lithuania","Latvia","Estonia","Germany","Bulgaria","Greece","Turkey","Albania","Croatia","Switzerland","Luxembourg","Belgium","Netherlands","Portugal","Spain","Ireland","New Caledonia","Solomon Islands","New Zealand","Australia","Sri Lanka","China","Taiwan","Italy","Denmark","United Kingdom","Iceland","Azerbaijan","Georgia","Philippines","Malaysia","Brunei Darussalam","Slovenia","Finland","Slovakia","Czech Republic","Eritrea","Japan","Paraguay","Yemen","Saudi Arabia","Antarctica","Northern Cyprus","Cyprus","Morocco","Egypt","Libya","Ethiopia","Djibouti","Somaliland","Uganda","Rwanda","Bosnia and Herzegovina","Macedonia","Serbia","Montenegro","Kosovo","Trinidad and Tobago","South Sudan"],["Oceania","Africa","Africa","North America","North America","Asia","Asia","Oceania","Asia","South America","South America","Africa","Africa","Africa","Africa","Africa","North America","North America","Europe","North America","South America","Europe","North America","Seven seas (open ocean)","Asia","Africa","Africa","North America","South America","South America","South America","South America","South America","North America","North America","North America","North America","North America","North America","North America","South America","South America","South America","Europe","South America","North America","North America","North America","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Asia","Asia","Africa","Asia","Africa","Africa","Africa","Asia","Asia","Asia","Asia","Asia","Asia","Oceania","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Asia","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Oceania","Oceania","Oceania","Oceania","Asia","Asia","Asia","Europe","Europe","Europe","Europe","Asia","Asia","Asia","Asia","Asia","Europe","Europe","Europe","Europe","Africa","Asia","South America","Asia","Asia","Antarctica","Asia","Asia","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Europe","Europe","Europe","Europe","Europe","North America","Africa"],["Oceania","Africa","Africa","Americas","Americas","Asia","Asia","Oceania","Asia","Americas","Americas","Africa","Africa","Africa","Africa","Africa","Americas","Americas","Europe","Americas","Americas","Europe","Americas","Seven seas (open ocean)","Asia","Africa","Africa","Americas","Americas","Americas","Americas","Americas","Americas","Americas","Americas","Americas","Americas","Americas","Americas","Americas","Americas","Americas","Americas","Europe","Americas","Americas","Americas","Americas","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Asia","Asia","Africa","Asia","Africa","Africa","Africa","Asia","Asia","Asia","Asia","Asia","Asia","Oceania","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Asia","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Asia","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Europe","Oceania","Oceania","Oceania","Oceania","Asia","Asia","Asia","Europe","Europe","Europe","Europe","Asia","Asia","Asia","Asia","Asia","Europe","Europe","Europe","Europe","Africa","Asia","Americas","Asia","Asia","Antarctica","Asia","Asia","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Africa","Europe","Europe","Europe","Europe","Europe","Americas","Africa"],["Melanesia","Eastern Africa","Northern Africa","Northern America","Northern America","Central Asia","Central Asia","Melanesia","South-Eastern Asia","South America","South America","Middle Africa","Eastern Africa","Eastern Africa","Northern Africa","Middle Africa","Caribbean","Caribbean","Eastern Europe","Caribbean","South America","Northern Europe","Northern America","Seven seas (open ocean)","South-Eastern Asia","Southern Africa","Southern Africa","Central America","South America","South America","South America","South America","South America","Central America","Central America","Central America","Central America","Central America","Central America","Central America","South America","South America","South America","Western Europe","South America","Caribbean","Caribbean","Caribbean","Eastern Africa","Southern Africa","Southern Africa","Western Africa","Western Africa","Western Africa","Western Africa","Western Africa","Western Africa","Middle Africa","Western Africa","Western Africa","Western Africa","Western Africa","Western Africa","Western Africa","Western Africa","Western Africa","Middle Africa","Middle Africa","Middle Africa","Middle Africa","Eastern Africa","Eastern Africa","Eastern Africa","Southern Africa","Middle Africa","Eastern Africa","Western Asia","Western Asia","Eastern Africa","Western Asia","Western Africa","Northern Africa","Northern Africa","Western Asia","Western Asia","Western Asia","Western Asia","Western Asia","Western Asia","Melanesia","South-Eastern Asia","South-Eastern Asia","South-Eastern Asia","South-Eastern Asia","South-Eastern Asia","Eastern Asia","Eastern Asia","Eastern Asia","Southern Asia","Southern Asia","Southern Asia","Southern Asia","Southern Asia","Southern Asia","Central Asia","Central Asia","Central Asia","Southern Asia","Western Asia","Western Asia","Northern Europe","Eastern Europe","Eastern Europe","Eastern Europe","Western Europe","Eastern Europe","Eastern Europe","Eastern Europe","Northern Europe","Northern Europe","Northern Europe","Western Europe","Eastern Europe","Southern Europe","Western Asia","Southern Europe","Southern Europe","Western Europe","Western Europe","Western Europe","Western Europe","Southern Europe","Southern Europe","Northern Europe","Melanesia","Melanesia","Australia and New Zealand","Australia and New Zealand","Southern Asia","Eastern Asia","Eastern Asia","Southern Europe","Northern Europe","Northern Europe","Northern Europe","Western Asia","Western Asia","South-Eastern Asia","South-Eastern Asia","South-Eastern Asia","Southern Europe","Northern Europe","Eastern Europe","Eastern Europe","Eastern Africa","Eastern Asia","South America","Western Asia","Western Asia","Antarctica","Western Asia","Western Asia","Northern Africa","Northern Africa","Northern Africa","Eastern Africa","Eastern Africa","Eastern Africa","Eastern Africa","Eastern Africa","Southern Europe","Southern Europe","Southern Europe","Southern Europe","Southern Europe","Caribbean","Eastern Africa"],["Sovereign country","Sovereign country","Indeterminate","Sovereign country","Country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Dependency","Sovereign country","Country","Dependency","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Country","Sovereign country","Dependency","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Country","Sovereign country","Sovereign country","Disputed","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Country","Sovereign country","Sovereign country","Sovereign country","Dependency","Sovereign country","Country","Country","Sovereign country","Country","Sovereign country","Sovereign country","Country","Country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Indeterminate","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Indeterminate","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country","Sovereign country"],[19289.9707329765,932745.792357074,96270.60104084721,10036042.9767873,9510743.744824581,2729810.51298781,461410.258459096,464520.072464586,1819251.32898731,2784468.58938384,814844.2204878021,2323492.47746214,484332.792984678,590836.914195733,1850885.56479243,1271694.59820398,28540.5459842261,48157.8742821646,17018507.4094666,15584.7908248632,16363.7987423901,397994.628980977,2206644.43953262,11602.5718467462,14714.9313315426,1216400.83108031,27505.6549786909,1969480.30676826,176853.635919616,8508557.091825729,1085269.59559136,1309699.63635968,1151882.92596349,75265.4490305216,53832.1357021123,129540.211674483,113789.774793235,20893.3402330773,109459.048786204,22045.4508313613,908499.070492869,209801.857246846,144268.722604462,644847.882258842,250747.109536984,9224.663167074759,12460.5868709093,114866.218150043,376328.488742711,591912.017166329,824886.560992482,194390.438881923,1235561.37340316,1054107.1940836,116998.712578633,1182269.64800007,905071.739171952,460324.701614163,60966.9622339568,243473.120281533,329825.951440485,239565.079458458,36191.8856963154,98206.7829620829,75980.3314665435,271593.671943161,621860.349185054,339681.855452815,269475.797919465,27120.5747694609,751921.215016539,111197.018347598,810994.757216461,18118.6341282849,1245463.74769785,26238.9478592737,22991.165807789,10099.0030328829,589382.827011519,5037.10382587155,14031.2844514589,156237.321647096,2315916.65788588,89207.13690631661,79880.73828096691,11327.854664807,16652.1196912198,436965.03416826,309302.033595231,7490.040146716,182235.977782045,510125.56979289,229080.422295565,679573.994237083,335990.801728306,125679.216030188,99044.36683048939,1544322.15019105,3142892.09769282,133782.141414655,39377.4020057345,150706.871321559,874119.998315395,652270.070308025,138111.759254274,195874.658497004,480809.521855032,1617559.0402466,185004.125494595,28656.6007515336,450581.582203591,208969.829718131,572548.983743491,310402.33298673,85064.89515859541,92476.460365273,32320.3917738368,238356.297115474,63831.0914781956,63923.5330136017,44678.1968086173,357430.341206566,110216.875059118,131964.646663977,798849.164057534,29694.8002916761,57530.8517530272,46185.2506729716,2416.87048266498,30126.0378859233,40024.104481118,93408.59409916009,502306.467818081,58457.5134141208,23219.0117362846,24728.114237136,277627.604539654,7687613.84310903,65370.3895242611,9409830.493433909,34345.7011138443,315104.851197605,42759.9277031922,249986.395211549,107735.721363006,91113.2541543127,69048.16050446031,292256.939380041,338226.486563138,10700.3342457981,19118.1227179494,341242.33887092,47068.0820296185,81207.60292943619,119319.584873889,404619.932853689,401335.916394788,455915.007254186,1920324.14608918,12335956.0763551,3786.36450592132,6207.00619061686,591718.98943203,996311.623193406,1633720.7173726,1132393.1671779,21880.2505119017,167349.612740013,245768.479387209,23365.4111927782,50605.0748516557,25062.2552860575,76388.6050646267,13443.6780594717,11230.2616721538,7737.80985537389,624909.0990858451],[885806,52234869,null,35535348,318622525,17288285,30757700,7755785,255131116,42981515,17613798,73722860,13513125,46024250,37737913,13569438,10572466,10405844,143819666,382169,null,null,56295,null,1212814,54539571,2145785,124221600,3419546,204213133,10562159,30973354,47791911,3903986,4757575,6013997,8809216,6281189,15923559,351694,30738378,763393,547928,null,15903112,3534874,2862087,11439767,15411675,2168573,2370992,14546111,16962846,4063920,10286712,19148219,176460502,22239904,7228915,26962563,22531350,11805509,1725744,4390737,7079162,17585977,4515392,4871101,1875713,1129424,15620974,17068838,27212382,1295097,26920466,9891790,8215700,5603279,23589801,4294682,1917852,11143908,39113313,8809306,9070867,2374419,3782450,35006080,3960925,258850,15270790,68416772,6576397,51924182,92544915,25116363,50746659,2923896,1293859294,159405279,776448,28323241,185546257,32758020,8362745,5835500,5466241,78411092,19203090,2906220,9696110,9474511,45271947,38011735,8546356,9866468,3556397,19908979,2932367,1993782,1314545,80982500,7223938,10892413,77030628,2889104,4238389,8188649,556319,11209057,16865008,10401062,46480882,4657740,268050,575504,4509700,23504138,20771000,1364270000,null,60789140,5643475,64613160,327386,9535079,3727000,100102249,30228017,411704,2061980,5461512,5418649,10525347,null,127276000,6552584,26246327,30776722,null,null,1152309,34318082,91812566,6204108,97366774,912164,null,38833338,11345357,3566002,2077495,7130576,621810,1821800,1354493,11530971],[69.95999999999999,64.163,null,81.9530487804878,78.84146341463411,71.62,71.039,65.23,68.85599999999999,76.252,79.117,58.782,55.467,66.242,64.002,52.204,62.757,73.483,70.7436585365854,75.379,null,null,null,null,68.285,60.993,53.268,76.753,77.19,75.042,68.357,74.518,74.02200000000001,77.61,79.44,74.884,73.181,73.015,72.869,70.027,74.196,66.425,71.13800000000001,null,75.879,79.3901219512195,75.68899999999999,79.41500000000001,59.36,64.78,62.981,66.376,57.007,62.907,60.373,59.228,52.549,57.111,59.601,62.154,52.52,58.846,56.598,61.527,50.951,59.457,50.621,63.536,65.211,57.18,60.775,61.932,57.099,56.287,60.858,56.688,82.1536585365854,79.23099999999999,65.133,73.126,60.707,75.33499999999999,75.64100000000001,74.03400000000001,76.94799999999999,77.88800000000001,74.458,69.458,76.578,71.709,68.251,74.895,65.97499999999999,66.285,75.855,71.179,81.72195121951221,68.84699999999999,68.021,71.803,69.43000000000001,69.511,66.139,62.895,70.69,70.4024390243902,67.55200000000001,75.46599999999999,69.81699999999999,74.255,82.25365853658541,72.9707317073171,71.1865853658537,77.60243902439031,81.490243902439,75.7634146341463,71.258,74.9609756097561,74.51707317073171,74.1243902439024,77.0341463414634,81.090243902439,74.4658536585366,81.3853658536585,75.239,77.96299999999999,77.4780487804878,83.1975609756098,82.2292682926829,81.2878048780488,81.7073170731707,81.1219512195122,83.2292682926829,81.3487804878049,77.25287259572259,70.113,81.4048780487805,82.3,74.90600000000001,75.932,null,83.090243902439,80.7,81.30487804878049,82.8609756097561,71.8,72.95099999999999,68.813,74.976,76.917,81.0780487804878,81.1804878048781,76.81219512195121,78.8243902439024,64.17400000000001,83.5878048780488,72.913,64.523,74.23399999999999,null,null,80.173,75.309,71.12,71.65900000000001,64.535,62.006,null,59.224,66.188,76.56100000000001,75.384,75.33658536585369,76.712,71.0975609756098,70.426,55.817],[8222.25378436842,2402.09940362843,null,43079.1425247165,51921.9846391384,23587.3375151466,5370.86580208835,3709.08164370316,10003.0890293448,18797.5479465897,22195.2743713617,785.347340663008,null,2753.23613475312,4188.33481399507,2076.65000798778,1652.85480345734,12663.0422473566,25284.5862019855,28456.8165292476,null,null,null,null,6262.90551556596,12389.7146679241,2677.19807805197,16622.5970457658,19827.5649886027,15374.2615071807,6324.82725807651,11547.8342162709,12715.9673914398,20017.9943624961,14372.4007814474,4784.83046366078,4231.32506716223,6890.72322429183,7147.42922806486,7999.57369198528,16745.0219796981,6906.01230864481,15306.6924367639,null,10901.4185562194,35066.0463763697,8051.24402830602,null,1925.138698418,15914.6702328332,9617.3969565111,2218.55191733521,1865.16062183071,3655.38850923143,2001.0772890116,904.456729989966,5671.9006010195,3196.36152634263,1315.3402595533,3868.60089371873,3054.53487386428,1734.73674695657,1398.25480632738,804.719886747093,1692.14206707555,1582.33369667322,597.135168986395,5538.05294137178,16678.6381326502,31542.5107726021,3632.50375331402,1090.3672076732,1079.82386564737,7870.97074814257,6257.15287433489,803.172837396172,31702.0835366295,13831.3752293893,1372.02096124513,4319.52828287882,1550.21843235512,10767.0276518537,13483.3378622219,8622.18546801292,63943.1858285789,120860.06755829,70832.36836452071,14838.3829483763,40365.2732623193,2892.34160435097,3124.31929344274,14857.202932021,5436.48264275006,4770.01209867368,5264.82809971072,null,33425.6895931418,11348.6473412397,5385.14181406703,2973.0415646346,7366.42412644897,2266.18429824848,4576.2270153496,1838.96024371997,2546.50048351137,3181.64216292265,14332.3657698371,16924.2006778247,null,7971.11792762162,44167.6318669891,17944.2098463253,8243.47351509088,24347.0736576846,44320.5020125474,24161.4255236519,4762.7808726743,19677.5202527307,26258.2100974103,22172.2535081352,27113.6859213723,43560.6192440775,16302.3205614307,24081.6305378246,22401.8804311394,10701.1207857986,20334.4464738451,57218.0279263612,93655.33416306481,41360.3955755286,45668.4414721322,26023.6978492184,31195.4052422035,48898.3286615603,null,2139.56074060145,34455.3312172237,43547.1974836868,10650.3901782483,12758.647789259,null,33945.8438783585,45057.0741699595,38251.7924802929,41701.1372653816,16715.1055213058,8749.156189273521,6585.89594870884,24194.6339084542,76089.2865740815,28417.656441512,39017.5372069548,27285.284673711,29119.6166119074,null,37337.3174057788,8501.54353959203,3766.80525494897,49958.4433361471,null,null,29786.3656529772,7078.88148932392,9879.79935855302,16371.9021546442,1424.52698442707,null,null,1637.27508138464,1629.86886584829,10516.7864355965,12298.4901835571,13112.9089581967,14796.6353955591,8698.291558898831,31181.8211959284,1935.87940008879]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>iso_a2<\/th>\n      <th>name_long<\/th>\n      <th>continent<\/th>\n      <th>region_un<\/th>\n      <th>subregion<\/th>\n      <th>type<\/th>\n      <th>area_km2<\/th>\n      <th>pop<\/th>\n      <th>lifeExp<\/th>\n      <th>gdpPercap<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"headerCallback":"function(thead) {\n  $(thead).css('font-size', '0.7em');\n}","columnDefs":[{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":9,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":10,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[7,8,9,10]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100],"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'font-size':'12px'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'font-size':'12px'});\nvar value=data[3]; $(this.api().cell(row, 3).node()).css({'font-size':'12px'});\nvar value=data[4]; $(this.api().cell(row, 4).node()).css({'font-size':'12px'});\nvar value=data[5]; $(this.api().cell(row, 5).node()).css({'font-size':'12px'});\nvar value=data[6]; $(this.api().cell(row, 6).node()).css({'font-size':'12px'});\nvar value=data[7]; $(this.api().cell(row, 7).node()).css({'font-size':'12px'});\nvar value=data[8]; $(this.api().cell(row, 8).node()).css({'font-size':'12px'});\nvar value=data[9]; $(this.api().cell(row, 9).node()).css({'font-size':'12px'});\nvar value=data[10]; $(this.api().cell(row, 10).node()).css({'font-size':'12px'});\n}"}},"evals":["options.headerCallback","options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.rowCallback"],"jsHooks":[]}</script>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="資料清洗與處理.html#cb2-1" tabindex="-1"></a><span class="co"># 咖啡產量資料</span></span>
<span id="cb2-2"><a href="資料清洗與處理.html#cb2-2" tabindex="-1"></a>coffee<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ChiaJung-Yeh/Transport-Analysis/master/Data/coffee.csv&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-096bb1bfb71cfea236d0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-096bb1bfb71cfea236d0">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47"],["Angola","Bolivia","Brazil","Burundi","Cameroon","Central African Republic","Congo, Dem. Rep. of","Colombia","Costa Rica","Cote d'Ivoire","Cuba","Dominican Republic","Ecuador","El Salvador","Ethiopia","Gabon","Ghana","Guatemala","Honduras","India","Indonesia","Jamaica","Kenya","Liberia","Madagascar","Malawi","Mexico","Nepal","Nicaragua","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Rwanda","Sierra Leone","Tanzania","Thailand","Timor-Leste","Togo","Uganda","Venezuela","Vietnam","Yemen","Zambia","Zimbabwe","Others"],[null,3,3277,37,8,null,4,1330,28,114,null,1,87,5,215,null,1,58,149,453,742,null,60,null,3,3,151,null,42,3,114,null,585,2,36,1,81,39,14,2,408,null,1844,4,3,1,23],[null,4,2786,38,6,null,12,1169,32,130,null,null,62,8,283,null,1,70,165,566,360,1,50,null,5,1,220,null,45,3,74,null,625,null,42,3,66,16,2,3,443,null,1700,1,null,1,26]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name_long<\/th>\n      <th>coffee_production_2016<\/th>\n      <th>coffee_production_2017<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"headerCallback":"function(thead) {\n  $(thead).css('font-size', '0.7em');\n}","columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100],"rowCallback":"function(row, data, displayNum, displayIndex, dataIndex) {\nvar value=data[1]; $(this.api().cell(row, 1).node()).css({'font-size':'12px'});\nvar value=data[2]; $(this.api().cell(row, 2).node()).css({'font-size':'12px'});\nvar value=data[3]; $(this.api().cell(row, 3).node()).css({'font-size':'12px'});\n}"}},"evals":["options.headerCallback","options.rowCallback"],"jsHooks":[]}</script>
<p>世界國家資料（<code>world</code>）中詳記各國資訊，包括人口數（pop）、面積（area_km2）、lifeExp（壽命）、gdpPerCap（人均 GDP）等；咖啡（<code>coffee</code>）資料中詳記世界各國 2016 與 2017 年的咖啡產量。</p>
<div id="data.frame-與-data.table" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> data.frame 與 data.table<a href="資料清洗與處理.html#data.frame-與-data.table" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>dplyr</code>與<code>data.table</code>套件所提供的各函式大多功能皆相同，惟使用<code>data.table</code>套件的函式時，必須將資料型別新增 data.table 之格式，尚能正確分析。此外，<code>data.table</code>套件的執行效率通常較高，在大數據處理上極具優勢（依據實務經驗而論，若處理的資料筆數上達千萬筆，建議使用<code>data.table</code>套件），而若數據量較小時兩者的速度不相上下。關於兩資料分析套件的速度比較請參考以下文章：</p>
<ul>
<li><a href="https://tysonbarrett.com/jekyll/update/2019/10/06/datatable_memory/">Comparing Efficiency and Speed of <code>data.table</code></a><br />
</li>
<li><a href="https://towardsdatascience.com/data-table-speed-with-dplyr-syntax-yes-we-can-51ef9aaed585">data.table speed with dplyr syntax</a></li>
</ul>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 新增 data.table 資料格式</strong>
</p>
<p>建立 data.table 型態之資料可以透過<code>data.table()</code>函式直接建構，其撰寫架構與<code>data.frame()</code>完全相同。而若欲針對原 data.frame 新增 data.table 之資料格式，可利用<code>setDT()</code>函式新增之，以<code>world</code>資料為例，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="資料清洗與處理.html#cb3-1" tabindex="-1"></a><span class="co"># 使用read.csv()讀取資料 -&gt; data.frame()</span></span>
<span id="cb3-2"><a href="資料清洗與處理.html#cb3-2" tabindex="-1"></a>world_DT<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ChiaJung-Yeh/Transport-Analysis/master/Data/world.csv&quot;</span>)</span>
<span id="cb3-3"><a href="資料清洗與處理.html#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="資料清洗與處理.html#cb3-4" tabindex="-1"></a><span class="co"># 查看資料型態</span></span>
<span id="cb3-5"><a href="資料清洗與處理.html#cb3-5" tabindex="-1"></a><span class="fu">class</span>(world_DT)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="資料清洗與處理.html#cb5-1" tabindex="-1"></a><span class="co"># setDT()函式新增data.table格式</span></span>
<span id="cb5-2"><a href="資料清洗與處理.html#cb5-2" tabindex="-1"></a><span class="fu">setDT</span>(world_DT)</span>
<span id="cb5-3"><a href="資料清洗與處理.html#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="資料清洗與處理.html#cb5-4" tabindex="-1"></a><span class="co"># 再次查看資料型態</span></span>
<span id="cb5-5"><a href="資料清洗與處理.html#cb5-5" tabindex="-1"></a><span class="fu">class</span>(world_DT)</span></code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<p>由最後輸出結果可知，<code>world_DT</code>資料經過<code>setDT()</code>函式設定後即新增 data.table 格式，同時亦會保留 data.frame 格式。</p>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 新增主鍵</strong>
</p>
<p>主鍵是資料中用以標示「關鍵的」屬性欄位，「關鍵」意謂該欄位具有唯一性，可以用其檢索整份資料，不會重複匹配至多比不同的資料。舉例而言，在考生成績的資料中，我們會利用學生的學號、姓名等作為主鍵，因為其具有代表性，可以表示特定資料；然而，我們不會利用學生的分數作為主鍵，因為分數值很可能是重複的，無法表示特定一筆資料。</p>
<p>根據上述，在 data.table 的資料格式中，主鍵是相當關鍵的要素，亦為使<code>data.table</code>套件效率甚高的其一原因。以<code>world_DT</code>資料為例，將「name_long」（國家名稱）設定為主鍵，函式撰寫如下。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="資料清洗與處理.html#cb7-1" tabindex="-1"></a><span class="co"># 建立主鍵</span></span>
<span id="cb7-2"><a href="資料清洗與處理.html#cb7-2" tabindex="-1"></a><span class="fu">setDT</span>(world_DT, name_long)</span></code></pre></div>
</div>
<div id="合併資料" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> 合併資料<a href="資料清洗與處理.html#合併資料" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 合併欄與列</strong>
</p>
<p>在第一章節中，我們曾提及資料框的<a href="r-語言基礎語法.html#資料框data-frame">行列合併</a>，包含<code>rbind()</code>與<code>cbind()</code>兩函式，而<code>dplyr</code>套件所提供的<code>bind_rows()</code>與<code>bind_cols()</code>其目的相同，前者用以合併橫列；後者用以合併直行。其中<code>bind_cols()</code>與<code>cbind()</code>兩者功能完全相同。惟<code>rbind()</code>函式的使用前提是，輸入的兩資料必須擁有完全相同的欄位，一旦其中一個欄位不符合即無法合併資料。<code>bind_rows()</code>函式則可較彈性合併資料，針對共同擁有的欄位予以合併，其他則忽略之。具體範例如下。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="資料清洗與處理.html#cb8-1" tabindex="-1"></a><span class="co"># 建立兩資料</span></span>
<span id="cb8-2"><a href="資料清洗與處理.html#cb8-2" tabindex="-1"></a>score_data1<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">Student=</span><span class="fu">c</span>(<span class="st">&quot;Robert&quot;</span>, <span class="st">&quot;Jessie&quot;</span>, <span class="st">&quot;Rose&quot;</span>, <span class="st">&quot;John&quot;</span>),</span>
<span id="cb8-3"><a href="資料清洗與處理.html#cb8-3" tabindex="-1"></a>                       <span class="at">Class=</span><span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;C&quot;</span>),</span>
<span id="cb8-4"><a href="資料清洗與處理.html#cb8-4" tabindex="-1"></a>                       <span class="at">Score=</span><span class="fu">c</span>(<span class="st">&quot;80&quot;</span>, <span class="st">&quot;95&quot;</span>, <span class="st">&quot;70&quot;</span>, <span class="st">&quot;65&quot;</span>))</span>
<span id="cb8-5"><a href="資料清洗與處理.html#cb8-5" tabindex="-1"></a></span>
<span id="cb8-6"><a href="資料清洗與處理.html#cb8-6" tabindex="-1"></a>score_data2<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">Student=</span><span class="fu">c</span>(<span class="st">&quot;Penny&quot;</span>, <span class="st">&quot;Ruby&quot;</span>, <span class="st">&quot;Tom&quot;</span>),</span>
<span id="cb8-7"><a href="資料清洗與處理.html#cb8-7" tabindex="-1"></a>                       <span class="at">Score=</span><span class="fu">c</span>(<span class="st">&quot;90&quot;</span>, <span class="st">&quot;70&quot;</span>, <span class="st">&quot;50&quot;</span>))</span>
<span id="cb8-8"><a href="資料清洗與處理.html#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="資料清洗與處理.html#cb8-9" tabindex="-1"></a><span class="fu">rbind</span>(score_data1, score_data2)</span></code></pre></div>
<pre><code>## Error in rbind(deparse.level, ...): 變數的行數無效</code></pre>
<p>由以上<code>rbind()</code>函式之範例可知，由於<code>score_data1</code>含有「Class」欄位，而<code>score_data2</code>並不包含，故無法成功合併兩資料。此時可嘗試利用<code>bind_rows()</code>函式，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="資料清洗與處理.html#cb10-1" tabindex="-1"></a><span class="fu">bind_rows</span>(score_data1, score_data2)</span></code></pre></div>
<pre><code>##   Student Class Score
## 1  Robert     A    80
## 2  Jessie     B    95
## 3    Rose     D    70
## 4    John     C    65
## 5   Penny  &lt;NA&gt;    90
## 6    Ruby  &lt;NA&gt;    70
## 7     Tom  &lt;NA&gt;    50</code></pre>
<p>輸出結果中，<code>score_data2</code>雖並無「Class」欄位，仍可將兩資料予以合併，並在缺失的資料中填補<code>NA</code>。</p>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 合併儲存於陣列中的資料</strong>
</p>
<p>在<code>data.table</code>套件中另提供<code>rbindlist()</code>函式，可將儲存於陣列中的所有資料予以合併，程式碼撰寫如下。惟使用此函式時，必須確保陣列中所有資料的欄位名稱一致。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="資料清洗與處理.html#cb12-1" tabindex="-1"></a>data_list<span class="ot">=</span><span class="fu">list</span>(<span class="fu">data.frame</span>(<span class="at">Var1=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">Var2=</span><span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;E&quot;</span>)),</span>
<span id="cb12-2"><a href="資料清洗與處理.html#cb12-2" tabindex="-1"></a>               <span class="fu">data.frame</span>(<span class="at">Var1=</span><span class="fu">c</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>), <span class="at">Var2=</span><span class="fu">c</span>(<span class="st">&quot;F&quot;</span>,<span class="st">&quot;G&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;I&quot;</span>,<span class="st">&quot;J&quot;</span>)))</span>
<span id="cb12-3"><a href="資料清洗與處理.html#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="資料清洗與處理.html#cb12-4" tabindex="-1"></a><span class="co"># 查看data_list陣列</span></span>
<span id="cb12-5"><a href="資料清洗與處理.html#cb12-5" tabindex="-1"></a>data_list</span>
<span id="cb12-6"><a href="資料清洗與處理.html#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="資料清洗與處理.html#cb12-7" tabindex="-1"></a><span class="co">#合併所有陣列中的資料</span></span>
<span id="cb12-8"><a href="資料清洗與處理.html#cb12-8" tabindex="-1"></a><span class="fu">rbindlist</span>(data_list)</span></code></pre></div>
</div>
<div id="選取資料欄位" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> 選取資料欄位<a href="資料清洗與處理.html#選取資料欄位" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>在第一章節中，我們曾提及資料框選取欄位的方法，而<code>dplyr</code>套建亦提供相同功能的<code>select()</code>函式，函式撰寫如下。</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="資料清洗與處理.html#cb13-1" tabindex="-1"></a><span class="fu">select</span>(資料, 欄位名稱1, 欄位名稱2, ...)</span></code></pre></div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 選取欄位</strong>
</p>
<p>以選取<code>world</code>資料中的「name_long」和「area_km2」兩欄位為例，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="資料清洗與處理.html#cb14-1" tabindex="-1"></a><span class="co"># 選取name_long與area_km2兩欄位</span></span>
<span id="cb14-2"><a href="資料清洗與處理.html#cb14-2" tabindex="-1"></a>world_sel1<span class="ot">=</span><span class="fu">select</span>(world, name_long, area_km2)</span>
<span id="cb14-3"><a href="資料清洗與處理.html#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="資料清洗與處理.html#cb14-4" tabindex="-1"></a><span class="co"># 查看前六筆資料</span></span>
<span id="cb14-5"><a href="資料清洗與處理.html#cb14-5" tabindex="-1"></a><span class="fu">head</span>(world_sel1)</span></code></pre></div>
<pre><code>##        name_long    area_km2
## 1           Fiji    19289.97
## 2       Tanzania   932745.79
## 3 Western Sahara    96270.60
## 4         Canada 10036042.98
## 5  United States  9510743.74
## 6     Kazakhstan  2729810.51</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件選取欄位</strong>
</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="資料清洗與處理.html#cb16-1" tabindex="-1"></a>world_DT[, .(name_long, area_km2)]</span></code></pre></div>
</div>
<p>其他寫法包括（請回顧<a href="r-語言基礎語法.html#資料框data-frame">選取欄位</a>章節）：</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="資料清洗與處理.html#cb17-1" tabindex="-1"></a><span class="co"># 給定欄位索引</span></span>
<span id="cb17-2"><a href="資料清洗與處理.html#cb17-2" tabindex="-1"></a>world[, <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>)]</span>
<span id="cb17-3"><a href="資料清洗與處理.html#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="資料清洗與處理.html#cb17-4" tabindex="-1"></a><span class="co"># 給定欄位名稱</span></span>
<span id="cb17-5"><a href="資料清洗與處理.html#cb17-5" tabindex="-1"></a>world[, <span class="fu">c</span>(<span class="st">&quot;name_long&quot;</span>, <span class="st">&quot;area_km2&quot;</span>)]</span>
<span id="cb17-6"><a href="資料清洗與處理.html#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="資料清洗與處理.html#cb17-7" tabindex="-1"></a><span class="co"># 回傳單一欄位</span></span>
<span id="cb17-8"><a href="資料清洗與處理.html#cb17-8" tabindex="-1"></a>world<span class="sc">$</span>name_long</span>
<span id="cb17-9"><a href="資料清洗與處理.html#cb17-9" tabindex="-1"></a>world<span class="sc">$</span>area_km2</span></code></pre></div>
<p>此外，亦可將欲返回的欄位儲存於一文字向量中，並透過<code>all_of()</code>函式回傳之，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="資料清洗與處理.html#cb18-1" tabindex="-1"></a><span class="co"># 選取name_long與area_km2兩欄位</span></span>
<span id="cb18-2"><a href="資料清洗與處理.html#cb18-2" tabindex="-1"></a>sel_col_name<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;name_long&quot;</span>, <span class="st">&quot;continent&quot;</span>, <span class="st">&quot;subregion&quot;</span>)</span>
<span id="cb18-3"><a href="資料清洗與處理.html#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="資料清洗與處理.html#cb18-4" tabindex="-1"></a><span class="co"># 使用all_of()函式</span></span>
<span id="cb18-5"><a href="資料清洗與處理.html#cb18-5" tabindex="-1"></a>world_sel2<span class="ot">=</span><span class="fu">select</span>(world, <span class="fu">all_of</span>(sel_col_name))</span>
<span id="cb18-6"><a href="資料清洗與處理.html#cb18-6" tabindex="-1"></a></span>
<span id="cb18-7"><a href="資料清洗與處理.html#cb18-7" tabindex="-1"></a><span class="co"># 查看前六筆資料</span></span>
<span id="cb18-8"><a href="資料清洗與處理.html#cb18-8" tabindex="-1"></a><span class="fu">head</span>(world_sel2)</span></code></pre></div>
<pre><code>##        name_long     continent        subregion
## 1           Fiji       Oceania        Melanesia
## 2       Tanzania        Africa   Eastern Africa
## 3 Western Sahara        Africa  Northern Africa
## 4         Canada North America Northern America
## 5  United States North America Northern America
## 6     Kazakhstan          Asia     Central Asia</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件選取欄位</strong>
</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="資料清洗與處理.html#cb20-1" tabindex="-1"></a>world_DT[, ..sel_col_name]</span></code></pre></div>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 刪除欄位</strong>
</p>
<p>若欲刪除特定欄位，可利用<code>-</code>在欄位名稱前即可刪除之。</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="資料清洗與處理.html#cb21-1" tabindex="-1"></a><span class="co"># 刪除continent、region_un、subregion、type欄位</span></span>
<span id="cb21-2"><a href="資料清洗與處理.html#cb21-2" tabindex="-1"></a>world_sel3<span class="ot">=</span><span class="fu">select</span>(world, <span class="sc">-</span>continent, <span class="sc">-</span>region_un, <span class="sc">-</span>subregion, <span class="sc">-</span>type)</span>
<span id="cb21-3"><a href="資料清洗與處理.html#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="資料清洗與處理.html#cb21-4" tabindex="-1"></a><span class="co"># 查看前六筆資料</span></span>
<span id="cb21-5"><a href="資料清洗與處理.html#cb21-5" tabindex="-1"></a><span class="fu">head</span>(world_sel3)</span></code></pre></div>
<pre><code>##   iso_a2      name_long    area_km2       pop  lifeExp gdpPercap
## 1     FJ           Fiji    19289.97    885806 69.96000  8222.254
## 2     TZ       Tanzania   932745.79  52234869 64.16300  2402.099
## 3     EH Western Sahara    96270.60        NA       NA        NA
## 4     CA         Canada 10036042.98  35535348 81.95305 43079.143
## 5     US  United States  9510743.74 318622525 78.84146 51921.985
## 6     KZ     Kazakhstan  2729810.51  17288285 71.62000 23587.338</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件刪除欄位</strong>
</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="資料清洗與處理.html#cb23-1" tabindex="-1"></a>del_col_name<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;continent&quot;</span>,<span class="st">&quot;region_un&quot;</span>,<span class="st">&quot;subregion&quot;</span>,<span class="st">&quot;type&quot;</span>)</span>
<span id="cb23-2"><a href="資料清洗與處理.html#cb23-2" tabindex="-1"></a>world_DT[, <span class="sc">!</span>..del_col_name]</span></code></pre></div>
</div>
</div>
<div id="依條件篩選資料" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> 依條件篩選資料<a href="資料清洗與處理.html#依條件篩選資料" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>條件篩選資料可以利用<code>filter()</code>函式達成之，函式撰寫如下。</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="資料清洗與處理.html#cb24-1" tabindex="-1"></a><span class="fu">filter</span>(資料, 條件1, 條件2, ...)</span></code></pre></div>
<p>以上<code>條件1</code>與<code>條件2</code>是用以篩選資料中符合條件者，最終所回傳的資料必然符合函式內<strong>所有</strong>的條件。</p>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 數值向量篩選</strong>
</p>
<p>以篩選<code>world</code>資料中，人口數（<code>pop</code>）超過 1 億人者。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="資料清洗與處理.html#cb25-1" tabindex="-1"></a><span class="co"># 篩選人口數超過1億的資料</span></span>
<span id="cb25-2"><a href="資料清洗與處理.html#cb25-2" tabindex="-1"></a>world_fil1<span class="ot">=</span><span class="fu">filter</span>(world, pop<span class="sc">&gt;</span><span class="dv">100000000</span>)</span>
<span id="cb25-3"><a href="資料清洗與處理.html#cb25-3" tabindex="-1"></a></span>
<span id="cb25-4"><a href="資料清洗與處理.html#cb25-4" tabindex="-1"></a><span class="co"># 查看前六筆資料</span></span>
<span id="cb25-5"><a href="資料清洗與處理.html#cb25-5" tabindex="-1"></a><span class="fu">head</span>(world_fil1)</span></code></pre></div>
<pre><code>##   iso_a2          name_long     continent region_un          subregion
## 1     US      United States North America  Americas   Northern America
## 2     ID          Indonesia          Asia      Asia South-Eastern Asia
## 3     RU Russian Federation        Europe    Europe     Eastern Europe
## 4     MX             Mexico North America  Americas    Central America
## 5     BR             Brazil South America  Americas      South America
## 6     NG            Nigeria        Africa    Africa     Western Africa
##                type   area_km2       pop  lifeExp gdpPercap
## 1           Country  9510743.7 318622525 78.84146 51921.985
## 2 Sovereign country  1819251.3 255131116 68.85600 10003.089
## 3 Sovereign country 17018507.4 143819666 70.74366 25284.586
## 4 Sovereign country  1969480.3 124221600 76.75300 16622.597
## 5 Sovereign country  8508557.1 204213133 75.04200 15374.262
## 6 Sovereign country   905071.7 176460502 52.54900  5671.901</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="資料清洗與處理.html#cb27-1" tabindex="-1"></a><span class="co"># 查看查看符合條件的總資料筆數（亦即國家數）</span></span>
<span id="cb27-2"><a href="資料清洗與處理.html#cb27-2" tabindex="-1"></a><span class="fu">nrow</span>(world_fil1)</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件篩選資料</strong>
</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="資料清洗與處理.html#cb29-1" tabindex="-1"></a>world_DT[pop<span class="sc">&gt;</span><span class="dv">100000000</span>]</span></code></pre></div>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 文字向量篩選</strong>
</p>
<p>通常文字篩選時會利用<code>%in%</code>以查看一向量各元素是否存在於另一向量中，請參照<a href="r-語言基礎語法.html#向量vector">向量 Vector</a>小節中「⌾ 檢查元素是否包含於向量」。</p>
<p>以篩選<code>world</code>資料中，所在洲隸屬於亞洲（Asia）以及歐洲（Europe）者。</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="資料清洗與處理.html#cb30-1" tabindex="-1"></a><span class="co"># filter data by population</span></span>
<span id="cb30-2"><a href="資料清洗與處理.html#cb30-2" tabindex="-1"></a>world_fil2<span class="ot">=</span><span class="fu">filter</span>(world, continent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>))</span>
<span id="cb30-3"><a href="資料清洗與處理.html#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="資料清洗與處理.html#cb30-4" tabindex="-1"></a><span class="co"># check out the first 6 rows</span></span>
<span id="cb30-5"><a href="資料清洗與處理.html#cb30-5" tabindex="-1"></a><span class="fu">head</span>(world_fil2)</span></code></pre></div>
<pre><code>##   iso_a2          name_long continent region_un          subregion
## 1     KZ         Kazakhstan      Asia      Asia       Central Asia
## 2     UZ         Uzbekistan      Asia      Asia       Central Asia
## 3     ID          Indonesia      Asia      Asia South-Eastern Asia
## 4     RU Russian Federation    Europe    Europe     Eastern Europe
## 5     NO             Norway    Europe    Europe    Northern Europe
## 6     TL        Timor-Leste      Asia      Asia South-Eastern Asia
##                type    area_km2       pop  lifeExp gdpPercap
## 1 Sovereign country  2729810.51  17288285 71.62000 23587.338
## 2 Sovereign country   461410.26  30757700 71.03900  5370.866
## 3 Sovereign country  1819251.33 255131116 68.85600 10003.089
## 4 Sovereign country 17018507.41 143819666 70.74366 25284.586
## 5 Sovereign country   397994.63        NA       NA        NA
## 6 Sovereign country    14714.93   1212814 68.28500  6262.906</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件篩選資料</strong>
</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="資料清洗與處理.html#cb32-1" tabindex="-1"></a>world_DT[continent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>)]</span></code></pre></div>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 多重條件篩選（AND）</strong>
</p>
<p>在<code>filter()</code>函式中所設定的諸多條件皆須滿足尚會進一步保留資料。以<code>world</code>資料為例，篩選洲隸屬於亞洲以及歐洲，且人口數超過 1 億者。程式碼撰寫如下。</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="資料清洗與處理.html#cb33-1" tabindex="-1"></a><span class="co"># 依條件篩選資料</span></span>
<span id="cb33-2"><a href="資料清洗與處理.html#cb33-2" tabindex="-1"></a>world_fil3<span class="ot">=</span><span class="fu">filter</span>(world, continent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>), pop<span class="sc">&gt;</span><span class="dv">100000000</span>)</span>
<span id="cb33-3"><a href="資料清洗與處理.html#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="資料清洗與處理.html#cb33-4" tabindex="-1"></a><span class="co"># 查看前六筆資料</span></span>
<span id="cb33-5"><a href="資料清洗與處理.html#cb33-5" tabindex="-1"></a><span class="fu">head</span>(world_fil3)</span></code></pre></div>
<pre><code>##   iso_a2          name_long continent region_un          subregion
## 1     ID          Indonesia      Asia      Asia South-Eastern Asia
## 2     RU Russian Federation    Europe    Europe     Eastern Europe
## 3     IN              India      Asia      Asia      Southern Asia
## 4     BD         Bangladesh      Asia      Asia      Southern Asia
## 5     PK           Pakistan      Asia      Asia      Southern Asia
## 6     CN              China      Asia      Asia       Eastern Asia
##                type   area_km2        pop  lifeExp gdpPercap
## 1 Sovereign country  1819251.3  255131116 68.85600 10003.089
## 2 Sovereign country 17018507.4  143819666 70.74366 25284.586
## 3 Sovereign country  3142892.1 1293859294 68.02100  5385.142
## 4 Sovereign country   133782.1  159405279 71.80300  2973.042
## 5 Sovereign country   874120.0  185546257 66.13900  4576.227
## 6           Country  9409830.5 1364270000 75.93200 12758.648</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="資料清洗與處理.html#cb35-1" tabindex="-1"></a><span class="co"># 查看查看符合條件的總資料筆數（亦即國家數）</span></span>
<span id="cb35-2"><a href="資料清洗與處理.html#cb35-2" tabindex="-1"></a><span class="fu">nrow</span>(world_fil3)</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<p>除可以直接以「逗號」分隔各項條件外，亦可利用「<code>&amp;</code>」串接所有條件，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="資料清洗與處理.html#cb37-1" tabindex="-1"></a><span class="co"># 利用&amp;串接所有條件</span></span>
<span id="cb37-2"><a href="資料清洗與處理.html#cb37-2" tabindex="-1"></a>world_fil4<span class="ot">=</span><span class="fu">filter</span>(world, continent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>) <span class="sc">&amp;</span> pop<span class="sc">&gt;</span><span class="dv">100000000</span>)</span></code></pre></div>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件篩選資料</strong>
</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="資料清洗與處理.html#cb38-1" tabindex="-1"></a>world_DT[continent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>) <span class="sc">&amp;</span> pop<span class="sc">&gt;</span><span class="dv">100000000</span>]</span></code></pre></div>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 多重條件（OR）</strong>
</p>
<p><code>filter()</code>函式係需要所有條件皆滿足尚會回傳資料，然而有時我們希望其一條件成立即可，此時可以將各項條件以「<code>|</code>」分開，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="資料清洗與處理.html#cb39-1" tabindex="-1"></a><span class="co"># 滿足其一條建篩選資料</span></span>
<span id="cb39-2"><a href="資料清洗與處理.html#cb39-2" tabindex="-1"></a>world_fil5<span class="ot">=</span><span class="fu">filter</span>(world, continent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>) <span class="sc">|</span> pop<span class="sc">&gt;</span><span class="dv">100000000</span>)</span>
<span id="cb39-3"><a href="資料清洗與處理.html#cb39-3" tabindex="-1"></a></span>
<span id="cb39-4"><a href="資料清洗與處理.html#cb39-4" tabindex="-1"></a><span class="co"># 查看查看符合條件的總資料筆數（亦即國家數）</span></span>
<span id="cb39-5"><a href="資料清洗與處理.html#cb39-5" tabindex="-1"></a><span class="fu">nrow</span>(world_fil5)</span></code></pre></div>
<pre><code>## [1] 90</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件篩選資料</strong>
</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="資料清洗與處理.html#cb41-1" tabindex="-1"></a>world_DT[continent <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>) <span class="sc">|</span> pop<span class="sc">&gt;</span><span class="dv">100000000</span>]</span></code></pre></div>
</div>
</div>
<div id="新增資料屬性" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> 新增資料屬性<a href="資料清洗與處理.html#新增資料屬性" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>前面所提及的<a href="資料清洗與處理.html#合併資料"><code>cbind()</code>與<code>bind_cols()</code>函式</a>可以將欄位予以合併，藉此擴充資料屬性。此外，於第一章節中所提及的向量「<code>$</code>」亦可新增資料屬性。除以上寫法外，可利用<code>dplyr</code>套件中的<code>mutate()</code>函式擴增資料屬性，且操作更具有彈性。函式撰寫如下。</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="資料清洗與處理.html#cb42-1" tabindex="-1"></a><span class="fu">mutate</span>(資料, 新變數1<span class="ot">=</span>..., 新變數2<span class="ot">=</span>..., ...)</span></code></pre></div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 新增資料屬性</strong>
</p>
<p>以<code>world</code>資料為例，新增「各國人口密度(pop_dens)」之欄位（人口密度即總人口數除以面積），並新增一欄位串接 continent 和 subregion（使用<a href="r-語言基礎語法.html#連接字串"><code>paste0()</code></a>函式串接向量）。程式碼撰寫如下。</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="資料清洗與處理.html#cb43-1" tabindex="-1"></a><span class="co"># 新增人口密度屬性</span></span>
<span id="cb43-2"><a href="資料清洗與處理.html#cb43-2" tabindex="-1"></a>world_mut<span class="ot">=</span><span class="fu">mutate</span>(world, <span class="at">pop_dens=</span>pop<span class="sc">/</span>area_km2,</span>
<span id="cb43-3"><a href="資料清洗與處理.html#cb43-3" tabindex="-1"></a>                 <span class="at">district=</span><span class="fu">paste0</span>(continent, <span class="st">&quot; (&quot;</span>, subregion, <span class="st">&quot;)&quot;</span>))</span>
<span id="cb43-4"><a href="資料清洗與處理.html#cb43-4" tabindex="-1"></a></span>
<span id="cb43-5"><a href="資料清洗與處理.html#cb43-5" tabindex="-1"></a><span class="co"># 查看前六筆資料</span></span>
<span id="cb43-6"><a href="資料清洗與處理.html#cb43-6" tabindex="-1"></a><span class="fu">head</span>(world_mut[, <span class="fu">c</span>(<span class="st">&quot;name_long&quot;</span>, <span class="st">&quot;area_km2&quot;</span>, <span class="st">&quot;pop&quot;</span>, <span class="st">&quot;pop_dens&quot;</span>, <span class="st">&quot;district&quot;</span>)])</span></code></pre></div>
<pre><code>##        name_long    area_km2       pop  pop_dens
## 1           Fiji    19289.97    885806 45.920547
## 2       Tanzania   932745.79  52234869 56.001184
## 3 Western Sahara    96270.60        NA        NA
## 4         Canada 10036042.98  35535348  3.540773
## 5  United States  9510743.74 318622525 33.501326
## 6     Kazakhstan  2729810.51  17288285  6.333145
##                           district
## 1              Oceania (Melanesia)
## 2          Africa (Eastern Africa)
## 3         Africa (Northern Africa)
## 4 North America (Northern America)
## 5 North America (Northern America)
## 6              Asia (Central Asia)</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件新增資料屬性</strong>
</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="資料清洗與處理.html#cb45-1" tabindex="-1"></a><span class="co"># 新增一個變數時</span></span>
<span id="cb45-2"><a href="資料清洗與處理.html#cb45-2" tabindex="-1"></a>world_mut<span class="ot">=</span>world_DT[, pop_dens <span class="sc">:=</span> pop<span class="sc">/</span>area_km2]</span>
<span id="cb45-3"><a href="資料清洗與處理.html#cb45-3" tabindex="-1"></a></span>
<span id="cb45-4"><a href="資料清洗與處理.html#cb45-4" tabindex="-1"></a><span class="co"># 新增多個變數時</span></span>
<span id="cb45-5"><a href="資料清洗與處理.html#cb45-5" tabindex="-1"></a>world_mut<span class="ot">=</span>world_DT[, <span class="fu">c</span>(<span class="st">&quot;pop_dens&quot;</span>, <span class="st">&quot;district&quot;</span>) <span class="sc">:=</span> .(pop<span class="sc">/</span>area_km2, <span class="fu">paste0</span>(continent, <span class="st">&quot; (&quot;</span>, subregion, <span class="st">&quot;)&quot;</span>))]</span></code></pre></div>
<p>由以上程式碼可知，透過<code>data.table</code>套件新增欄位時，須利用「<code>:=</code>」定義運算方式，並將新增的欄位名稱置於其左側，而運算過程則放置於右側。</p>
</div>
<p>其他寫法如下（請回顧<a href="r-語言基礎語法.html#資料框data-frame">擴增資料欄（新增屬性）</a>小節）：</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="資料清洗與處理.html#cb46-1" tabindex="-1"></a><span class="co"># 利用$直接新增欄位</span></span>
<span id="cb46-2"><a href="資料清洗與處理.html#cb46-2" tabindex="-1"></a>world<span class="sc">$</span>pop_dens<span class="ot">=</span>world<span class="sc">$</span>pop<span class="sc">/</span>world<span class="sc">$</span>area_km2</span>
<span id="cb46-3"><a href="資料清洗與處理.html#cb46-3" tabindex="-1"></a>world<span class="sc">$</span>district<span class="ot">=</span><span class="fu">paste0</span>(world<span class="sc">$</span>continent, <span class="st">&quot; (&quot;</span>, world<span class="sc">$</span>subregion, <span class="st">&quot;)&quot;</span>)</span></code></pre></div>
</div>
<div id="條件判斷" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> 條件判斷<a href="資料清洗與處理.html#條件判斷" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 使用<code>ifelse()</code>函式判斷</strong>
</p>
<p>於前一章中有提及「<a href="r-語言基礎語法.html#邏輯判斷">邏輯判斷</a>」的流程控制方法，其中<code>ifelse()</code>函式可大幅縮減程式碼。在此亦可透過<code>mutate()</code>函式搭配<code>ifelse()</code>函式建立邏輯判斷的結果。以<code>world</code>資料為例，新增一欄位判斷國家面積的大小，若國家面積大於整體資料中位數，標記為「L」；否則記錄為「S」。程式碼撰寫如下。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="資料清洗與處理.html#cb47-1" tabindex="-1"></a><span class="co"># 先計算面積中位數</span></span>
<span id="cb47-2"><a href="資料清洗與處理.html#cb47-2" tabindex="-1"></a>area_med<span class="ot">=</span><span class="fu">median</span>(world<span class="sc">$</span>area_km2)</span>
<span id="cb47-3"><a href="資料清洗與處理.html#cb47-3" tabindex="-1"></a></span>
<span id="cb47-4"><a href="資料清洗與處理.html#cb47-4" tabindex="-1"></a><span class="co"># 利用ifelse函式判斷類群</span></span>
<span id="cb47-5"><a href="資料清洗與處理.html#cb47-5" tabindex="-1"></a>world_ifel<span class="ot">=</span><span class="fu">mutate</span>(world, <span class="at">TYPE=</span><span class="fu">ifelse</span>(area_km2<span class="sc">&gt;=</span>area_med, <span class="st">&quot;L&quot;</span>, <span class="st">&quot;S&quot;</span>))</span>
<span id="cb47-6"><a href="資料清洗與處理.html#cb47-6" tabindex="-1"></a></span>
<span id="cb47-7"><a href="資料清洗與處理.html#cb47-7" tabindex="-1"></a><span class="co"># 查看六筆資料</span></span>
<span id="cb47-8"><a href="資料清洗與處理.html#cb47-8" tabindex="-1"></a><span class="fu">head</span>(world_ifel[, <span class="fu">c</span>(<span class="st">&quot;name_long&quot;</span>, <span class="st">&quot;area_km2&quot;</span>, <span class="st">&quot;TYPE&quot;</span>)])</span></code></pre></div>
<pre><code>##        name_long    area_km2 TYPE
## 1           Fiji    19289.97    S
## 2       Tanzania   932745.79    L
## 3 Western Sahara    96270.60    S
## 4         Canada 10036042.98    L
## 5  United States  9510743.74    L
## 6     Kazakhstan  2729810.51    L</code></pre>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 使用<code>case_when()</code>函式判斷</strong>
</p>
<p><code>ifelse()</code>函式較適合應用於單純的邏輯判斷，若涉及多項判斷式可能須建立巢狀迴圈，使程式碼變得甚為複雜。此時我們可應用<code>dplyr</code>套件中的<code>case_when()</code>函式，並同樣搭配<a href="資料清洗與處理.html#新增資料屬性"><code>mutate()</code></a>函式以新增欄位。<code>case_when()</code>函式撰寫架構如下：</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="資料清洗與處理.html#cb49-1" tabindex="-1"></a><span class="fu">case_when</span>(欄位, </span>
<span id="cb49-2"><a href="資料清洗與處理.html#cb49-2" tabindex="-1"></a>          條件1 <span class="sc">~</span> 結果1, </span>
<span id="cb49-3"><a href="資料清洗與處理.html#cb49-3" tabindex="-1"></a>          條件2 <span class="sc">~</span> 結果2, </span>
<span id="cb49-4"><a href="資料清洗與處理.html#cb49-4" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> 結果3,</span>
<span id="cb49-5"><a href="資料清洗與處理.html#cb49-5" tabindex="-1"></a>          ...)</span></code></pre></div>
<p>其中的「<code>TRUE</code>」意謂著若前面所有條件皆「不成立」時，則回傳<code>TRUE</code>賦予的結果。</p>
<p>再次以<code>world</code>資料為例，若欲將所有國家依據面積及人口數予以分類，並藉由中位數劃分數值高低，最後分為「面積大人口多（LALP）」、「面積大人口少（LASP）」、「面積小人口多（SALP）」與「面積小人口少（SASP）」四者。程式碼撰寫如下。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="資料清洗與處理.html#cb50-1" tabindex="-1"></a><span class="co"># 先計算面積與人口數中位數</span></span>
<span id="cb50-2"><a href="資料清洗與處理.html#cb50-2" tabindex="-1"></a>area_med<span class="ot">=</span><span class="fu">median</span>(world<span class="sc">$</span>area_km2)</span>
<span id="cb50-3"><a href="資料清洗與處理.html#cb50-3" tabindex="-1"></a>pop_med<span class="ot">=</span><span class="fu">median</span>(world<span class="sc">$</span>pop, <span class="at">na.rm=</span>T) <span class="co"># 由於人口數中含有NA值，故設定na.rm=T以移除NA值後再計算</span></span>
<span id="cb50-4"><a href="資料清洗與處理.html#cb50-4" tabindex="-1"></a></span>
<span id="cb50-5"><a href="資料清洗與處理.html#cb50-5" tabindex="-1"></a><span class="co"># 使用case_when()函式新增分類</span></span>
<span id="cb50-6"><a href="資料清洗與處理.html#cb50-6" tabindex="-1"></a>world_casewhen<span class="ot">=</span><span class="fu">mutate</span>(world, <span class="at">TYPE=</span><span class="fu">case_when</span>(</span>
<span id="cb50-7"><a href="資料清洗與處理.html#cb50-7" tabindex="-1"></a>  area_km2<span class="sc">&gt;=</span>area_med <span class="sc">&amp;</span> pop<span class="sc">&gt;=</span>pop_med <span class="sc">~</span> <span class="st">&quot;LALP&quot;</span>,</span>
<span id="cb50-8"><a href="資料清洗與處理.html#cb50-8" tabindex="-1"></a>  area_km2<span class="sc">&gt;=</span>area_med <span class="sc">&amp;</span> pop<span class="sc">&lt;</span>pop_med <span class="sc">~</span> <span class="st">&quot;LASP&quot;</span>,</span>
<span id="cb50-9"><a href="資料清洗與處理.html#cb50-9" tabindex="-1"></a>  area_km2<span class="sc">&lt;</span>area_med <span class="sc">&amp;</span> pop<span class="sc">&gt;=</span>pop_med <span class="sc">~</span> <span class="st">&quot;SALP&quot;</span>,</span>
<span id="cb50-10"><a href="資料清洗與處理.html#cb50-10" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;SASP&quot;</span></span>
<span id="cb50-11"><a href="資料清洗與處理.html#cb50-11" tabindex="-1"></a>))</span>
<span id="cb50-12"><a href="資料清洗與處理.html#cb50-12" tabindex="-1"></a></span>
<span id="cb50-13"><a href="資料清洗與處理.html#cb50-13" tabindex="-1"></a><span class="co"># 查看六筆資料</span></span>
<span id="cb50-14"><a href="資料清洗與處理.html#cb50-14" tabindex="-1"></a><span class="fu">head</span>(world_casewhen[, <span class="fu">c</span>(<span class="st">&quot;name_long&quot;</span>, <span class="st">&quot;area_km2&quot;</span>, <span class="st">&quot;pop&quot;</span>, <span class="st">&quot;TYPE&quot;</span>)])</span></code></pre></div>
<pre><code>##        name_long    area_km2       pop TYPE
## 1           Fiji    19289.97    885806 SASP
## 2       Tanzania   932745.79  52234869 LALP
## 3 Western Sahara    96270.60        NA SASP
## 4         Canada 10036042.98  35535348 LALP
## 5  United States  9510743.74 318622525 LALP
## 6     Kazakhstan  2729810.51  17288285 LALP</code></pre>
</div>
<div id="資料排序" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> 資料排序<a href="資料清洗與處理.html#資料排序" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 資料排序（正序）</strong>
</p>
<p>在第一章節中我們提及許多排序的方法，包含<a href="#向量-vector">向量排序</a>（<code>sort()</code>、<code>order()</code>、<code>rank()</code>）與<a href="r-語言基礎語法.html#文字排序">文字排序</a>（<code>str_sort()</code>、<code>str_order()</code>）。而在此我們可以進一步藉由<code>dplyr</code>套件中的<code>arrange()</code>函式排序資料，其函式撰寫架構如下。</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="資料清洗與處理.html#cb52-1" tabindex="-1"></a><span class="fu">arrange</span>(資料, 待排序欄位)</span></code></pre></div>
<p>以<code>world</code>資料為例，若欲將所有國家依人口數由少至多排列，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="資料清洗與處理.html#cb53-1" tabindex="-1"></a>world_arr1<span class="ot">=</span><span class="fu">arrange</span>(world, pop)</span>
<span id="cb53-2"><a href="資料清洗與處理.html#cb53-2" tabindex="-1"></a></span>
<span id="cb53-3"><a href="資料清洗與處理.html#cb53-3" tabindex="-1"></a><span class="co"># 查看前六筆資料</span></span>
<span id="cb53-4"><a href="資料清洗與處理.html#cb53-4" tabindex="-1"></a><span class="fu">head</span>(world_arr1[, <span class="fu">c</span>(<span class="st">&quot;name_long&quot;</span>, <span class="st">&quot;continent&quot;</span>, <span class="st">&quot;pop&quot;</span>)])</span></code></pre></div>
<pre><code>##       name_long     continent    pop
## 1     Greenland North America  56295
## 2       Vanuatu       Oceania 258850
## 3 New Caledonia       Oceania 268050
## 4       Iceland        Europe 327386
## 5        Belize North America 351694
## 6       Bahamas North America 382169</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件排序</strong>
</p>
<p style="color:#4D0000;">
<strong>函式架構：</strong>
</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="資料清洗與處理.html#cb55-1" tabindex="-1"></a>資料[<span class="fu">order</span>(待排序欄位)]</span></code></pre></div>
<p>以<code>world</code>資料，依人口數由少至多排列為例，程式碼撰寫如下</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="資料清洗與處理.html#cb56-1" tabindex="-1"></a>world_DT[<span class="fu">order</span>(pop)]</span></code></pre></div>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 資料排序（倒序）</strong>
</p>
<p>須注意的是<code>arrange()</code>函式預設為由小到大（正序）排列，故若欲「倒序」排列，可在<code>待排序欄位</code>引數前面加上「<code>-</code>」即可，抑或使用<code>desc(待排序欄位)</code>函式。以<code>world</code>資料依人口數由多至少排列為例，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="資料清洗與處理.html#cb57-1" tabindex="-1"></a>world_arr2<span class="ot">=</span><span class="fu">arrange</span>(world, <span class="sc">-</span>pop)</span>
<span id="cb57-2"><a href="資料清洗與處理.html#cb57-2" tabindex="-1"></a></span>
<span id="cb57-3"><a href="資料清洗與處理.html#cb57-3" tabindex="-1"></a><span class="co"># 或使用desc()函式倒序排列</span></span>
<span id="cb57-4"><a href="資料清洗與處理.html#cb57-4" tabindex="-1"></a>world_arr2<span class="ot">=</span><span class="fu">arrange</span>(world, <span class="fu">desc</span>(pop))</span>
<span id="cb57-5"><a href="資料清洗與處理.html#cb57-5" tabindex="-1"></a></span>
<span id="cb57-6"><a href="資料清洗與處理.html#cb57-6" tabindex="-1"></a><span class="co"># 查看前六筆資料</span></span>
<span id="cb57-7"><a href="資料清洗與處理.html#cb57-7" tabindex="-1"></a><span class="fu">head</span>(world_arr2[, <span class="fu">c</span>(<span class="st">&quot;name_long&quot;</span>, <span class="st">&quot;continent&quot;</span>, <span class="st">&quot;pop&quot;</span>)])</span></code></pre></div>
<pre><code>##       name_long     continent        pop
## 1         China          Asia 1364270000
## 2         India          Asia 1293859294
## 3 United States North America  318622525
## 4     Indonesia          Asia  255131116
## 5        Brazil South America  204213133
## 6      Pakistan          Asia  185546257</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件倒序排列資料</strong>
</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="資料清洗與處理.html#cb59-1" tabindex="-1"></a>world_DT[<span class="fu">order</span>(<span class="sc">-</span>pop)]</span></code></pre></div>
</div>
</div>
<div id="資料分群與統計" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> 資料分群與統計<a href="資料清洗與處理.html#資料分群與統計" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 將資料依據特定欄位分群</strong>
</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="資料清洗與處理.html#cb60-1" tabindex="-1"></a><span class="fu">group_by</span>(資料, 分群欄位)</span></code></pre></div>
<p>利用<code>group_by()</code>函式分群後，資料並不會有任何變化，必須再搭配其他函式才能發揮分群的效果。</p>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 分群篩選資料（<code>filter()</code>）</strong>
</p>
<p>透過分群篩選資料，可篩選各群組符合條件者，函式撰寫架構如下。</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="資料清洗與處理.html#cb61-1" tabindex="-1"></a><span class="fu">group_by</span>(資料, 分群欄位)<span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="資料清洗與處理.html#cb61-2" tabindex="-1"></a>  <span class="fu">filter</span>(條件)</span></code></pre></div>
<p>以<code>world</code>資料為例，先將資料依據洲（continent）分群，而後篩選出各洲資料中面積最大者，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="資料清洗與處理.html#cb62-1" tabindex="-1"></a>world_gro1<span class="ot">=</span><span class="fu">group_by</span>(world, continent)<span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="資料清洗與處理.html#cb62-2" tabindex="-1"></a>  <span class="fu">filter</span>(area_km2<span class="sc">==</span><span class="fu">max</span>(area_km2))</span>
<span id="cb62-3"><a href="資料清洗與處理.html#cb62-3" tabindex="-1"></a></span>
<span id="cb62-4"><a href="資料清洗與處理.html#cb62-4" tabindex="-1"></a><span class="co"># 查看資料</span></span>
<span id="cb62-5"><a href="資料清洗與處理.html#cb62-5" tabindex="-1"></a>world_gro1[, <span class="fu">c</span>(<span class="st">&quot;continent&quot;</span>,<span class="st">&quot;name_long&quot;</span>,<span class="st">&quot;area_km2&quot;</span>)]</span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
## # Groups:   continent [8]
##   continent               name_long                            area_km2
##   &lt;chr&gt;                   &lt;chr&gt;                                   &lt;dbl&gt;
## 1 North America           Canada                              10036043.
## 2 Africa                  Democratic Republic of the Congo     2323492.
## 3 Europe                  Russian Federation                  17018507.
## 4 Seven seas (open ocean) French Southern and Antarctic Lands    11603.
## 5 South America           Brazil                               8508557.
## 6 Oceania                 Australia                            7687614.
## 7 Asia                    China                                9409830.
## 8 Antarctica              Antarctica                          12335956.</code></pre>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 分群篩選資料（<code>slice()</code>）</strong>
</p>
<p><code>slice()</code>函式用以回傳指定條件的索引值，故搭配<code>group_by()</code>時可以篩選各分群中的指定橫列位。函式撰寫架構如下。</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="資料清洗與處理.html#cb64-1" tabindex="-1"></a><span class="fu">group_by</span>(資料, 分群欄位)<span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="資料清洗與處理.html#cb64-2" tabindex="-1"></a>  <span class="fu">slice</span>(索引值)</span></code></pre></div>
<p>舉例而言，若欲回傳<code>world</code>資料中各分群內的第一筆資料，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="資料清洗與處理.html#cb65-1" tabindex="-1"></a>world_gro2<span class="ot">=</span><span class="fu">group_by</span>(world, continent)<span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="資料清洗與處理.html#cb65-2" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb65-3"><a href="資料清洗與處理.html#cb65-3" tabindex="-1"></a></span>
<span id="cb65-4"><a href="資料清洗與處理.html#cb65-4" tabindex="-1"></a><span class="co"># 查看資料</span></span>
<span id="cb65-5"><a href="資料清洗與處理.html#cb65-5" tabindex="-1"></a>world_gro2[, <span class="fu">c</span>(<span class="st">&quot;continent&quot;</span>,<span class="st">&quot;name_long&quot;</span>,<span class="st">&quot;area_km2&quot;</span>,<span class="st">&quot;pop&quot;</span>,<span class="st">&quot;lifeExp&quot;</span>,<span class="st">&quot;gdpPercap&quot;</span>)]</span></code></pre></div>
<pre><code>## # A tibble: 8 × 6
## # Groups:   continent [8]
##   continent               name_long           area_km2     pop lifeExp gdpPercap
##   &lt;chr&gt;                   &lt;chr&gt;                  &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1 Africa                  Tanzania              9.33e5  5.22e7    64.2     2402.
## 2 Antarctica              Antarctica            1.23e7 NA         NA         NA 
## 3 Asia                    Kazakhstan            2.73e6  1.73e7    71.6    23587.
## 4 Europe                  Russian Federation    1.70e7  1.44e8    70.7    25285.
## 5 North America           Canada                1.00e7  3.55e7    82.0    43079.
## 6 Oceania                 Fiji                  1.93e4  8.86e5    70.0     8222.
## 7 Seven seas (open ocean) French Southern an…   1.16e4 NA         NA         NA 
## 8 South America           Argentina             2.78e6  4.30e7    76.3    18798.</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件分群統計</strong>
</p>
<p style="color:#4D0000;">
<strong>函式架構：</strong>
</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="資料清洗與處理.html#cb67-1" tabindex="-1"></a>資料[, .SD[索引值], by<span class="ot">=</span>分群欄位]</span></code></pre></div>
<p>回傳<code>world</code>資料中各分群內的第一筆資料。</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="資料清洗與處理.html#cb68-1" tabindex="-1"></a>world_DT[, .SD[<span class="dv">1</span>], by<span class="ot">=</span>continent]</span></code></pre></div>
</div>
<p>此外，亦可擷取多個索引值的資料，舉例而言，若欲回傳<code>world</code>資料中各分群內的第一筆與最後一筆資料，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="資料清洗與處理.html#cb69-1" tabindex="-1"></a>world_gro3<span class="ot">=</span><span class="fu">group_by</span>(world, continent)<span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="資料清洗與處理.html#cb69-2" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>, <span class="fu">n</span>())</span>
<span id="cb69-3"><a href="資料清洗與處理.html#cb69-3" tabindex="-1"></a></span>
<span id="cb69-4"><a href="資料清洗與處理.html#cb69-4" tabindex="-1"></a><span class="co"># 查看資料</span></span>
<span id="cb69-5"><a href="資料清洗與處理.html#cb69-5" tabindex="-1"></a>world_gro3[, <span class="fu">c</span>(<span class="st">&quot;continent&quot;</span>,<span class="st">&quot;name_long&quot;</span>)]</span></code></pre></div>
<pre><code>## # A tibble: 16 × 2
## # Groups:   continent [8]
##    continent               name_long                          
##    &lt;chr&gt;                   &lt;chr&gt;                              
##  1 Africa                  Tanzania                           
##  2 Africa                  South Sudan                        
##  3 Antarctica              Antarctica                         
##  4 Antarctica              Antarctica                         
##  5 Asia                    Kazakhstan                         
##  6 Asia                    Cyprus                             
##  7 Europe                  Russian Federation                 
##  8 Europe                  Kosovo                             
##  9 North America           Canada                             
## 10 North America           Trinidad and Tobago                
## 11 Oceania                 Fiji                               
## 12 Oceania                 Australia                          
## 13 Seven seas (open ocean) French Southern and Antarctic Lands
## 14 Seven seas (open ocean) French Southern and Antarctic Lands
## 15 South America           Argentina                          
## 16 South America           Paraguay</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件分群統計</strong>
</p>
<p>回傳<code>world</code>資料中各分群（洲）內的第一筆與最後一筆資料，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="資料清洗與處理.html#cb71-1" tabindex="-1"></a>world_DT[, .SD[<span class="fu">c</span>(<span class="dv">1</span>, .N)], by<span class="ot">=</span>continent]</span></code></pre></div>
<p>上述程式碼中的<code>.N</code>意同<code>dplyr</code>套件中的<code>n()</code>。</p>
</div>
<p><code>group_by() %&gt;% slice()</code>函式亦可與<code>arrange()</code>函式結合，以擷取排序後特定序位的資料。再以<code>world</code>資料為例，若欲擷取每個洲前三大面積的國家，可以先利用<a href="資料清洗與處理.html#資料排序"><code>arrange()</code></a>函式將所有資料依據面積（area_km2）排列，而後再透過<code>group_by() %&gt;% slice()</code>函式擷取需要的索引值（即<code>1:3</code>）。程式碼撰寫如下。</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="資料清洗與處理.html#cb72-1" tabindex="-1"></a>world_gro4<span class="ot">=</span><span class="fu">arrange</span>(world, <span class="fu">desc</span>(area_km2))<span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="資料清洗與處理.html#cb72-2" tabindex="-1"></a>  <span class="fu">group_by</span>(continent)<span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="資料清洗與處理.html#cb72-3" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb72-4"><a href="資料清洗與處理.html#cb72-4" tabindex="-1"></a></span>
<span id="cb72-5"><a href="資料清洗與處理.html#cb72-5" tabindex="-1"></a><span class="co"># 查看資料</span></span>
<span id="cb72-6"><a href="資料清洗與處理.html#cb72-6" tabindex="-1"></a>world_gro4[, <span class="fu">c</span>(<span class="st">&quot;continent&quot;</span>,<span class="st">&quot;name_long&quot;</span>,<span class="st">&quot;area_km2&quot;</span>,<span class="st">&quot;pop&quot;</span>,<span class="st">&quot;lifeExp&quot;</span>,<span class="st">&quot;gdpPercap&quot;</span>)]</span></code></pre></div>
<pre><code>## # A tibble: 20 × 6
## # Groups:   continent [8]
##    continent               name_long          area_km2     pop lifeExp gdpPercap
##    &lt;chr&gt;                   &lt;chr&gt;                 &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1 Africa                  Democratic Republ…   2.32e6  7.37e7    58.8      785.
##  2 Africa                  Algeria              2.32e6  3.91e7    75.6    13483.
##  3 Africa                  Sudan                1.85e6  3.77e7    64.0     4188.
##  4 Antarctica              Antarctica           1.23e7 NA         NA         NA 
##  5 Asia                    China                9.41e6  1.36e9    75.9    12759.
##  6 Asia                    India                3.14e6  1.29e9    68.0     5385.
##  7 Asia                    Kazakhstan           2.73e6  1.73e7    71.6    23587.
##  8 Europe                  Russian Federation   1.70e7  1.44e8    70.7    25285.
##  9 Europe                  France               6.45e5 NA         NA         NA 
## 10 Europe                  Ukraine              5.73e5  4.53e7    71.2     8243.
## 11 North America           Canada               1.00e7  3.55e7    82.0    43079.
## 12 North America           United States        9.51e6  3.19e8    78.8    51922.
## 13 North America           Greenland            2.21e6  5.63e4    NA         NA 
## 14 Oceania                 Australia            7.69e6  2.35e7    82.3    43547.
## 15 Oceania                 Papua New Guinea     4.65e5  7.76e6    65.2     3709.
## 16 Oceania                 New Zealand          2.78e5  4.51e6    81.4    34455.
## 17 Seven seas (open ocean) French Southern a…   1.16e4 NA         NA         NA 
## 18 South America           Brazil               8.51e6  2.04e8    75.0    15374.
## 19 South America           Argentina            2.78e6  4.30e7    76.3    18798.
## 20 South America           Peru                 1.31e6  3.10e7    74.5    11548.</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件分群統計</strong>
</p>
<p>回傳<code>world</code>資料中各分群（洲）面積前三大的資料，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="資料清洗與處理.html#cb74-1" tabindex="-1"></a>world_DT[<span class="fu">order</span>(<span class="sc">-</span>area_km2)]<span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="資料清洗與處理.html#cb74-2" tabindex="-1"></a>  .[, .SD[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)], by<span class="ot">=</span>continent]</span></code></pre></div>
<p>與<code>dplyr</code>套件的撰寫方式相同，若欲串接不同的函式，可透過 pipe (<code>%&gt;%</code>) 連接。另外請注意此回傳結果會保留所有匹配與未匹配的資料，例如<code>world_DT</code>資料中 Antarctica 僅有一個區域，而由於我們尋找前六筆資料，此函式會回傳所有六筆結果，未匹配者則在其他筆資料中顯示<code>NA</code>。</p>
</div>
<p><code>group_by() %&gt;% filter()</code>函式無法透過多個條件設定，回傳符合各個不同條件的資料。然而實務上有時候希望擷取滿足多個不同條件的資料，此時可以利用<code>group() %&gt;% slice()</code>達成目的。</p>
<p>以<code>world</code>資料為例，先將資料依據洲（continent）分群，而後篩選出各洲資料中面積最大與最小者，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="資料清洗與處理.html#cb75-1" tabindex="-1"></a>world_gro5<span class="ot">=</span><span class="fu">group_by</span>(world, continent)<span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="資料清洗與處理.html#cb75-2" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">which.max</span>(area_km2),</span>
<span id="cb75-3"><a href="資料清洗與處理.html#cb75-3" tabindex="-1"></a>        <span class="fu">which.min</span>(area_km2))</span>
<span id="cb75-4"><a href="資料清洗與處理.html#cb75-4" tabindex="-1"></a></span>
<span id="cb75-5"><a href="資料清洗與處理.html#cb75-5" tabindex="-1"></a><span class="co"># 查看所有資料</span></span>
<span id="cb75-6"><a href="資料清洗與處理.html#cb75-6" tabindex="-1"></a>world_gro5[, <span class="fu">c</span>(<span class="st">&quot;continent&quot;</span>,<span class="st">&quot;name_long&quot;</span>,<span class="st">&quot;area_km2&quot;</span>)]</span></code></pre></div>
<pre><code>## # A tibble: 16 × 3
## # Groups:   continent [8]
##    continent               name_long                            area_km2
##    &lt;chr&gt;                   &lt;chr&gt;                                   &lt;dbl&gt;
##  1 Africa                  Democratic Republic of the Congo     2323492.
##  2 Africa                  The Gambia                             14031.
##  3 Antarctica              Antarctica                          12335956.
##  4 Antarctica              Antarctica                          12335956.
##  5 Asia                    China                                9409830.
##  6 Asia                    Northern Cyprus                         3786.
##  7 Europe                  Russian Federation                  17018507.
##  8 Europe                  Luxembourg                              2417.
##  9 North America           Canada                              10036043.
## 10 North America           Trinidad and Tobago                     7738.
## 11 Oceania                 Australia                            7687614.
## 12 Oceania                 Vanuatu                                 7490.
## 13 Seven seas (open ocean) French Southern and Antarctic Lands    11603.
## 14 Seven seas (open ocean) French Southern and Antarctic Lands    11603.
## 15 South America           Brazil                               8508557.
## 16 South America           Falkland Islands                       16364.</code></pre>
<p>以上程式碼中<code>which.max()</code>函式用以尋找最大值的索引；<code>which.min()</code>則尋找最小值之索引。此時利用<code>group_by() %&gt;% slice()</code>函式可同時回傳符合不同特定條件者。綜上所述，<code>group_by() %&gt;% slice()</code>函式的使用上相當具彈性。</p>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件分群統計</strong>
</p>
<p>回傳<code>world</code>資料中各分群（洲）面積最大與最小的資料，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="資料清洗與處理.html#cb77-1" tabindex="-1"></a>world_DT[, .SD[<span class="fu">c</span>(<span class="fu">which.min</span>(area_km2), <span class="fu">which.max</span>(area_km2))], by<span class="ot">=</span>continent]</span></code></pre></div>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 分群統計資料（<code>summarise()</code>）</strong>
</p>
<p>分群統計資料可針對各群組內的欄位做運算，如最大值、最小值、加總、平均…等，抑或使用自定義函式。分群統計資料的函式撰寫架構如下。</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="資料清洗與處理.html#cb78-1" tabindex="-1"></a><span class="fu">group_by</span>(資料, 分群欄位)<span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="資料清洗與處理.html#cb78-2" tabindex="-1"></a>  <span class="fu">summarise</span>(運算函式)</span></code></pre></div>
<p>以<code>world</code>資料為例，先將資料依據洲（continent）分群，而後統計各洲總人口數與國家數，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="資料清洗與處理.html#cb79-1" tabindex="-1"></a>world_gro6<span class="ot">=</span><span class="fu">group_by</span>(world, continent)<span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="資料清洗與處理.html#cb79-2" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pop=</span><span class="fu">sum</span>(pop, <span class="at">na.rm=</span>T),</span>
<span id="cb79-3"><a href="資料清洗與處理.html#cb79-3" tabindex="-1"></a>            <span class="at">County_N=</span><span class="fu">n</span>())</span>
<span id="cb79-4"><a href="資料清洗與處理.html#cb79-4" tabindex="-1"></a></span>
<span id="cb79-5"><a href="資料清洗與處理.html#cb79-5" tabindex="-1"></a><span class="co"># 輸出資料</span></span>
<span id="cb79-6"><a href="資料清洗與處理.html#cb79-6" tabindex="-1"></a>world_gro6</span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##   continent                      pop County_N
##   &lt;chr&gt;                        &lt;dbl&gt;    &lt;int&gt;
## 1 Africa                  1154946633       51
## 2 Antarctica                       0        1
## 3 Asia                    4311408059       47
## 4 Europe                   669036256       39
## 5 North America            565028684       18
## 6 Oceania                   37757833        7
## 7 Seven seas (open ocean)          0        1
## 8 South America            412060811       13</code></pre>
<p>請注意於本範例中由於總人口數（pop）欄位中含有部分 NA，故為避免計算結果有誤，須在<code>sum()</code>函式中設定<code>na.rm=T</code>引數。此外，由輸出結果可發現，有別於<code>group_by() %&gt;% filter()</code>函式會回傳所有的資料欄位，<code>group_by() %&gt;% summarise()</code>函式僅回傳指定的統計資料欄位。另外<code>n()</code>函式表示計算各分群內的總資料筆數。</p>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件分群統計</strong>
</p>
<p style="color:#4D0000;">
<strong>函式架構：</strong>
</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="資料清洗與處理.html#cb81-1" tabindex="-1"></a>資料[, .(運算函式), by<span class="ot">=</span>分群欄位]</span></code></pre></div>
<p>回傳<code>world</code>資料中各分群（洲）總人口數與國家個數。</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="資料清洗與處理.html#cb82-1" tabindex="-1"></a>world_DT[, .(<span class="at">pop=</span><span class="fu">sum</span>(pop, <span class="at">na.rm=</span>T), <span class="at">County_N=</span>.N), by<span class="ot">=</span>continent]</span></code></pre></div>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 分群統計資料（<code>reframe()</code>）</strong>
</p>
<p>除了<code>group_by() %&gt;% summarise()</code>以外，亦可使用<code>group_by() %&gt;% reframe()</code>達到相同目的，且適用的彈性更大。如以上的範例，<code>group_by() %&gt;% summarise()</code>回傳的是統計後的結果，通常<code>運算函式</code>僅回傳一個值，如<code>sum()</code>是針對所有群組內的特定變數做加總。然而有時候<code>運算函式</code>可能並非單純回傳一個值，例如<code>range()</code>函式回傳的是兩個值，包括最小值與最大值，此時使用<code>group_by() %&gt;% summarise()</code>雖能得到結果，但會出現警告訊息，而使用<code>group_by() %&gt;% reframe()</code>則可在無警告之下得到正確結果。<code>group_by() %&gt;% reframe()</code>的函式撰寫架構如下，與<code>group_by() %&gt;% summarise()</code>相同。</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="資料清洗與處理.html#cb83-1" tabindex="-1"></a><span class="fu">group_by</span>(資料, 分群欄位)<span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="資料清洗與處理.html#cb83-2" tabindex="-1"></a>  <span class="fu">reframe</span>(運算函式)</span></code></pre></div>
<p>再次以<code>world</code>資料為例，將資料依據洲（continent）分群，而後統計各洲人均 GDP（gdpPercap）的範圍，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="資料清洗與處理.html#cb84-1" tabindex="-1"></a>world_gro7<span class="ot">=</span><span class="fu">group_by</span>(world, continent)<span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="資料清洗與處理.html#cb84-2" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">gdpPercap=</span><span class="fu">range</span>(gdpPercap, <span class="at">na.rm=</span>T))</span>
<span id="cb84-3"><a href="資料清洗與處理.html#cb84-3" tabindex="-1"></a></span>
<span id="cb84-4"><a href="資料清洗與處理.html#cb84-4" tabindex="-1"></a><span class="co"># 輸出資料</span></span>
<span id="cb84-5"><a href="資料清洗與處理.html#cb84-5" tabindex="-1"></a>world_gro7</span></code></pre></div>
<pre><code>## # A tibble: 16 × 2
##    continent               gdpPercap
##    &lt;chr&gt;                       &lt;dbl&gt;
##  1 Africa                       597.
##  2 Africa                     31543.
##  3 Antarctica                   Inf 
##  4 Antarctica                  -Inf 
##  5 Asia                        1839.
##  6 Asia                      120860.
##  7 Europe                      4763.
##  8 Europe                     93655.
##  9 North America               1653.
## 10 North America              51922.
## 11 Oceania                     2140.
## 12 Oceania                    43547.
## 13 Seven seas (open ocean)      Inf 
## 14 Seven seas (open ocean)     -Inf 
## 15 South America               6325.
## 16 South America              22195.</code></pre>
<p>由以上程式碼可知各洲人均 GDP 的範圍。另須注意的是，由於「Antarctica」中所有國家並無人均 GDP 的資料，故回傳之上下界為 Inf 與 -Inf。</p>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件分群統計</strong>
</p>
<p>回傳<code>world</code>資料中各分群（洲）總人口數與國家個數，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="資料清洗與處理.html#cb86-1" tabindex="-1"></a>world_DT[, .(<span class="at">pop=</span><span class="fu">sum</span>(pop, <span class="at">na.rm=</span>T), <span class="at">County_N=</span>.N), by<span class="ot">=</span>continent]</span></code></pre></div>
</div>
</div>
<div id="連接資料" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> 連接資料<a href="資料清洗與處理.html#連接資料" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="資料清洗與處理.html#合併資料"><code>cbind</code>與<code>bind_cols()</code></a>函式是將兩份相同橫列數的資料直接予以合併，以連結兩份資料。不過在資料分析時，我們往往會有許多來源與目的不同的資料，而若希望將其合併，則必須依據「參照欄位」貼附。具體而論，<code>world</code>資料中記錄世界各國的詳細資訊，而<code>coffee</code>資料中則記錄世界各國的咖啡產量，若我們想同時知道各國的面積與咖啡產量，勢必需要將這兩份資料合併在一起，而合併的原則須依據「國家名稱」以貼附資料。</p>
<p>在<code>dplyr</code>套件中可以利用<code>join</code>相關函式，包括<A href="#left-join"><code>left_join()</code></A>、<A href="#full-join"><code>full_join()</code></A>與<A href="#inner-join"><code>inner_join()</code></A>。</p>
<p><code>left_join()</code>是只保留<strong>第一份（左側）</strong>所有資料，並依據參照欄位貼附第二份（右側）資料；<code>full_join()</code>是指所有<strong>兩份資料皆須保留</strong>，並進一步依據參照欄位相互貼附；<code>inner_join()</code>則是指保留兩份資料<strong>共同擁有</strong>的參照欄位，並依此相互貼附。</p>
<p>在<code>base</code>套件中與在<code>data.table</code>套件中，無論是何種形式的連接資料方式，皆可分別利用<code>merge()</code>與<code>merge.data.table()</code>函式達成目的，其中可透過設定引數（<code>all=</code>與<code>all.x=</code>）之方式決定連接資料的方式。</p>
<p>關於連接資料的概念詳見圖<a href="資料清洗與處理.html#fig:join-fig">2.1</a>之示意圖，而以上三套件連接資料的函式彙整如表<a href="資料清洗與處理.html#tab:join-table">2.2</a>。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:join-fig"></span>
<img src="figure/join.png" alt="連接資料示意圖" width="80%" />
<p class="caption">
圖 2.1: 連接資料示意圖
</p>
</div>
<table class="table table-striped table-hover" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:join-table">表 2.2: </span>連接資料函式彙整
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: black !important;background-color: #8E8E8E !important;">
資料連接方式
</th>
<th style="text-align:left;font-weight: bold;color: black !important;background-color: #8E8E8E !important;">
<code>dplyr</code>套件
</th>
<th style="text-align:left;font-weight: bold;color: black !important;background-color: #8E8E8E !important;">
<code>base</code>套件
</th>
<th style="text-align:left;font-weight: bold;color: black !important;background-color: #8E8E8E !important;">
<code>data.table</code>套件
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D0D0D0 !important;">
<a href="資料清洗與處理.html#left-join">以第一份（左側）資料為基準</a>
</td>
<td style="text-align:left;">
<code>left_join(資料1, 資料2)</code>
</td>
<td style="text-align:left;">
<code>merge(資料1, 資料2, all.x=T)</code>
</td>
<td style="text-align:left;">
<code>merge.data.table(資料1, 資料2, all.x=T)</code>
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D0D0D0 !important;">
<a href="資料清洗與處理.html#full-join">保留資料1與資料2所有資料</a>
</td>
<td style="text-align:left;">
<code>full_join(資料1, 資料2)</code>
</td>
<td style="text-align:left;">
<code>merge(資料1, 資料2, all=T)</code>
</td>
<td style="text-align:left;">
<code>merge.data.table(資料1, 資料2, all=T)</code>
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D0D0D0 !important;">
<a href="資料清洗與處理.html#inner-join">保留共同擁有的參照欄位之資料</a>
</td>
<td style="text-align:left;">
<code>inner_join(資料1, 資料2)</code>
</td>
<td style="text-align:left;">
<code>merge(資料1, 資料2)</code>
</td>
<td style="text-align:left;">
<code>merge.data.table(資料1, 資料2)</code>
</td>
</tr>
</tbody>
</table>
<H2 id="left-join">
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 以第一份（左側）資料為基準</strong>
</p>
</H2>
<p><code>left_join()</code>的函式撰寫架構如下。</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="資料清洗與處理.html#cb87-1" tabindex="-1"></a><span class="fu">left_join</span>(資料1, 資料2, <span class="at">by=</span><span class="st">&quot;參照欄位&quot;</span>)</span></code></pre></div>
<p>函式中的<code>by=</code>引數用以設定「參照欄位」，亦即若兩份資料的參照欄位內容是相同者，便將<code>資料2</code>的欄位貼附於<code>資料1</code>後。<code>left_join()</code>函式是保留<code>資料1</code>的所有資料，故若參照欄位的內容於<code>資料2</code>找不到相對應者，則該列貼附的結果會直接回傳「NA」。</p>
<p>另外需注意的是，<code>by=</code>引數可以不用設定，而此時該函式預設在兩份資料中尋找所有相同欄位名稱者作為參照欄位。而若兩份資料內欲參照的欄位名稱不相同時，引數設定須為<code>by=c(資料1參照欄位=資料2參照欄位)</code>。若有多個參照欄位，各欄位的名稱須以向量表達，如<code>by=c("參照欄位1", "參照欄位2")</code>。</p>
<p>以學生資料（<code>StuInfo</code>）與學生分數紀錄（<code>StuScore</code>）作為範例，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="資料清洗與處理.html#cb88-1" tabindex="-1"></a><span class="co"># 建立學生資料與分數資料</span></span>
<span id="cb88-2"><a href="資料清洗與處理.html#cb88-2" tabindex="-1"></a>StuInfo<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">StudentID=</span><span class="fu">c</span>(<span class="st">&quot;ID1&quot;</span>,<span class="st">&quot;ID2&quot;</span>,<span class="st">&quot;ID3&quot;</span>,<span class="st">&quot;ID4&quot;</span>,<span class="st">&quot;ID5&quot;</span>,<span class="st">&quot;ID6&quot;</span>),</span>
<span id="cb88-3"><a href="資料清洗與處理.html#cb88-3" tabindex="-1"></a>                   <span class="at">Class=</span><span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;A&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;A&quot;</span>),</span>
<span id="cb88-4"><a href="資料清洗與處理.html#cb88-4" tabindex="-1"></a>                   <span class="at">Name=</span><span class="fu">c</span>(<span class="st">&quot;Bob&quot;</span>,<span class="st">&quot;Mary&quot;</span>,<span class="st">&quot;Robert&quot;</span>,<span class="st">&quot;Jason&quot;</span>,<span class="st">&quot;Jane&quot;</span>,<span class="st">&quot;Jessie&quot;</span>))</span>
<span id="cb88-5"><a href="資料清洗與處理.html#cb88-5" tabindex="-1"></a>StuScore<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">StudentID=</span><span class="fu">c</span>(<span class="st">&quot;ID1&quot;</span>,<span class="st">&quot;ID2&quot;</span>,<span class="st">&quot;ID4&quot;</span>,<span class="st">&quot;ID5&quot;</span>,<span class="st">&quot;ID6&quot;</span>,<span class="st">&quot;ID7&quot;</span>),</span>
<span id="cb88-6"><a href="資料清洗與處理.html#cb88-6" tabindex="-1"></a>                    <span class="at">Score=</span><span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">90</span>))</span>
<span id="cb88-7"><a href="資料清洗與處理.html#cb88-7" tabindex="-1"></a></span>
<span id="cb88-8"><a href="資料清洗與處理.html#cb88-8" tabindex="-1"></a><span class="co"># 連接兩份資料</span></span>
<span id="cb88-9"><a href="資料清洗與處理.html#cb88-9" tabindex="-1"></a><span class="fu">left_join</span>(StuInfo, StuScore, <span class="at">by=</span><span class="st">&quot;StudentID&quot;</span>)</span></code></pre></div>
<pre><code>##   StudentID Class   Name Score
## 1       ID1     A    Bob    60
## 2       ID2     B   Mary    80
## 3       ID3     A Robert    NA
## 4       ID4     C  Jason    40
## 5       ID5     D   Jane    50
## 6       ID6     A Jessie   100</code></pre>
<p>以上程式碼中<code>by="StudentID"</code>即為兩份資料的共同參照欄位，由於兩參照欄位正好名稱相同，故若未設定此一引數亦可。另外從回傳結果可發現，由於資料 1（<code>StuInfo</code>）中並無學生代碼「ID7」，故該欄位的資料 2（<code>StuScore</code>）屬性皆為<code>NA。</code></p>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>base</code>與<code>data.table</code>套件連接資料</strong>
</p>
<p>在此二套件中，若連接方式為「<strong>以第一份（左側）資料為基準</strong>」，必須設定引數<strong><code>all.x=T</code></strong>。函式中的<code>by=</code>引數用以設定「參照欄位」，而若兩資料的參照欄位名稱不同時，需進一步設定<code>by.x=</code>與<code>by.y=</code>兩引數，分別為左側資料的參照欄位名稱與右側資料的欄位名稱。函式撰寫架構如下：</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="資料清洗與處理.html#cb90-1" tabindex="-1"></a><span class="co"># 若兩資料的參照欄位名稱不同</span></span>
<span id="cb90-2"><a href="資料清洗與處理.html#cb90-2" tabindex="-1"></a><span class="fu">merge</span>(資料1, 資料2, <span class="at">all.x=</span>T, <span class="at">by=</span><span class="st">&quot;參照欄位&quot;</span>)</span>
<span id="cb90-3"><a href="資料清洗與處理.html#cb90-3" tabindex="-1"></a><span class="fu">merge.data.table</span>(資料1, 資料2, <span class="at">all.x=</span>T, <span class="at">by=</span><span class="st">&quot;參照欄位&quot;</span>)</span>
<span id="cb90-4"><a href="資料清洗與處理.html#cb90-4" tabindex="-1"></a></span>
<span id="cb90-5"><a href="資料清洗與處理.html#cb90-5" tabindex="-1"></a><span class="co"># 若兩資料的參照欄位名稱不同</span></span>
<span id="cb90-6"><a href="資料清洗與處理.html#cb90-6" tabindex="-1"></a><span class="fu">merge</span>(資料1, 資料2, <span class="at">all.x=</span>T, <span class="at">by.x=</span><span class="st">&quot;資料1參照欄位&quot;</span>, <span class="at">by.y=</span><span class="st">&quot;資料2參照欄位&quot;</span>)</span>
<span id="cb90-7"><a href="資料清洗與處理.html#cb90-7" tabindex="-1"></a><span class="fu">merge.data.table</span>(資料1, 資料2, <span class="at">all.x=</span>T, <span class="at">by.x=</span><span class="st">&quot;資料1參照欄位&quot;</span>, <span class="at">by.y=</span><span class="st">&quot;資料2參照欄位&quot;</span>)</span></code></pre></div>
<p>以連接<code>StuInfo</code>與<code>StuScore</code>兩資料為例，參照欄位為「StudentID」。</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="資料清洗與處理.html#cb91-1" tabindex="-1"></a>StuInfo_DT<span class="ot">=</span><span class="fu">data.table</span>(<span class="at">StudentID=</span><span class="fu">c</span>(<span class="st">&quot;ID1&quot;</span>,<span class="st">&quot;ID2&quot;</span>,<span class="st">&quot;ID3&quot;</span>,<span class="st">&quot;ID4&quot;</span>,<span class="st">&quot;ID5&quot;</span>,<span class="st">&quot;ID6&quot;</span>),</span>
<span id="cb91-2"><a href="資料清洗與處理.html#cb91-2" tabindex="-1"></a>                      <span class="at">Class=</span><span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;A&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;A&quot;</span>),</span>
<span id="cb91-3"><a href="資料清洗與處理.html#cb91-3" tabindex="-1"></a>                      <span class="at">Name=</span><span class="fu">c</span>(<span class="st">&quot;Bob&quot;</span>,<span class="st">&quot;Mary&quot;</span>,<span class="st">&quot;Robert&quot;</span>,<span class="st">&quot;Jason&quot;</span>,<span class="st">&quot;Jane&quot;</span>,<span class="st">&quot;Jessie&quot;</span>))</span>
<span id="cb91-4"><a href="資料清洗與處理.html#cb91-4" tabindex="-1"></a>StuScore_DT<span class="ot">=</span><span class="fu">data.table</span>(<span class="at">StudentID=</span><span class="fu">c</span>(<span class="st">&quot;ID1&quot;</span>,<span class="st">&quot;ID2&quot;</span>,<span class="st">&quot;ID4&quot;</span>,<span class="st">&quot;ID5&quot;</span>,<span class="st">&quot;ID6&quot;</span>,<span class="st">&quot;ID7&quot;</span>),</span>
<span id="cb91-5"><a href="資料清洗與處理.html#cb91-5" tabindex="-1"></a>                       <span class="at">Score=</span><span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">90</span>))</span>
<span id="cb91-6"><a href="資料清洗與處理.html#cb91-6" tabindex="-1"></a></span>
<span id="cb91-7"><a href="資料清洗與處理.html#cb91-7" tabindex="-1"></a><span class="co"># base套件</span></span>
<span id="cb91-8"><a href="資料清洗與處理.html#cb91-8" tabindex="-1"></a><span class="fu">merge</span>(StuInfo, StuScore, <span class="at">all.x=</span>T, <span class="at">by=</span><span class="st">&quot;StudentID&quot;</span>)</span>
<span id="cb91-9"><a href="資料清洗與處理.html#cb91-9" tabindex="-1"></a></span>
<span id="cb91-10"><a href="資料清洗與處理.html#cb91-10" tabindex="-1"></a><span class="co"># data.table套件</span></span>
<span id="cb91-11"><a href="資料清洗與處理.html#cb91-11" tabindex="-1"></a><span class="fu">merge.data.table</span>(StuInfo_DT, StuScore_DT, <span class="at">all.x=</span>T, <span class="at">by=</span><span class="st">&quot;StudentID&quot;</span>)</span></code></pre></div>
</div>
<p>利用前述<code>world</code>與<code>coffee</code>兩資料，依據國家名稱相連接為例，在<code>world</code>資料中貼附各國咖啡的產量。程式碼撰寫如下。</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="資料清洗與處理.html#cb92-1" tabindex="-1"></a><span class="co"># 合併world與coffee兩資料</span></span>
<span id="cb92-2"><a href="資料清洗與處理.html#cb92-2" tabindex="-1"></a>world_coffee<span class="ot">=</span><span class="fu">left_join</span>(world, coffee, <span class="at">by=</span><span class="st">&quot;name_long&quot;</span>)</span>
<span id="cb92-3"><a href="資料清洗與處理.html#cb92-3" tabindex="-1"></a></span>
<span id="cb92-4"><a href="資料清洗與處理.html#cb92-4" tabindex="-1"></a><span class="co"># 將world_coffee依據coffee_production_2017由大至小排序</span></span>
<span id="cb92-5"><a href="資料清洗與處理.html#cb92-5" tabindex="-1"></a>world_coffee<span class="ot">=</span><span class="fu">arrange</span>(world_coffee, <span class="fu">desc</span>(coffee_production_2017))</span>
<span id="cb92-6"><a href="資料清洗與處理.html#cb92-6" tabindex="-1"></a></span>
<span id="cb92-7"><a href="資料清洗與處理.html#cb92-7" tabindex="-1"></a><span class="co"># 查看前六筆資料</span></span>
<span id="cb92-8"><a href="資料清洗與處理.html#cb92-8" tabindex="-1"></a><span class="fu">head</span>(world_coffee[, <span class="fu">c</span>(<span class="st">&quot;name_long&quot;</span>,<span class="st">&quot;continent&quot;</span>,<span class="st">&quot;coffee_production_2016&quot;</span>,<span class="st">&quot;coffee_production_2017&quot;</span>)])</span></code></pre></div>
<pre><code>##   name_long     continent coffee_production_2016 coffee_production_2017
## 1    Brazil South America                   3277                   2786
## 2   Vietnam          Asia                   1844                   1700
## 3  Colombia South America                   1330                   1169
## 4      Peru South America                    585                    625
## 5     India          Asia                    453                    566
## 6    Uganda        Africa                    408                    443</code></pre>
<p>請注意由於此範例中，<code>world</code>資料內的國家名稱欄位與<code>coffee</code>資料內的國家名稱相同，皆為「name_long」，故若不設定<code>by=</code>引數，亦可得到相同結果。</p>
<H2 id="full-join">
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 保留資料1與資料2所有資料</strong>
</p>
</H2>
<p><code>full_join()</code>的函式撰寫架構與前述<A href='#left-join'><code>left_join()</code></A>函式完全相同。</p>
<p>再次以<code>StuInfo</code>與<code>StuScore</code>兩資料為例，利用<code>full_join()</code>所得結果如下。</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="資料清洗與處理.html#cb94-1" tabindex="-1"></a><span class="fu">full_join</span>(StuInfo, StuScore, <span class="at">by=</span><span class="st">&quot;StudentID&quot;</span>)</span></code></pre></div>
<pre><code>##   StudentID Class   Name Score
## 1       ID1     A    Bob    60
## 2       ID2     B   Mary    80
## 3       ID3     A Robert    NA
## 4       ID4     C  Jason    40
## 5       ID5     D   Jane    50
## 6       ID6     A Jessie   100
## 7       ID7  &lt;NA&gt;   &lt;NA&gt;    90</code></pre>
<p>由以上結果可知，兩份資料中所有的「StudentID」皆會保留，而無法匹配資料者，顯示<code>NA</code>。例如「ID3」在<code>StuScore</code>中無紀錄；「ID7」在<code>StuInfo</code>中無紀錄，故配對後其他欄位的資料即顯示<code>NA</code>。</p>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>base</code>與<code>data.table</code>套件連接資料</strong>
</p>
<p>若連接方式為「<strong>保留資料1與資料2所有資料</strong>」，必須設定引數<strong><code>all=T</code></strong>，而其他引數之設定方式與前者相同。函式撰寫架構如下：</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="資料清洗與處理.html#cb96-1" tabindex="-1"></a><span class="fu">merge</span>(資料1, 資料2, <span class="at">all=</span>T, <span class="at">by=</span><span class="st">&quot;參照欄位&quot;</span>)</span>
<span id="cb96-2"><a href="資料清洗與處理.html#cb96-2" tabindex="-1"></a><span class="fu">merge.data.table</span>(資料1, 資料2, <span class="at">all=</span>T, <span class="at">by=</span><span class="st">&quot;參照欄位&quot;</span>)</span></code></pre></div>
<p>以連接<code>StuInfo</code>與<code>StuScore</code>兩資料為例，參照欄位為「StudentID」。</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="資料清洗與處理.html#cb97-1" tabindex="-1"></a><span class="co"># base套件</span></span>
<span id="cb97-2"><a href="資料清洗與處理.html#cb97-2" tabindex="-1"></a><span class="fu">merge</span>(StuInfo, StuScore, <span class="at">all=</span>T, <span class="at">by=</span><span class="st">&quot;StudentID&quot;</span>)</span>
<span id="cb97-3"><a href="資料清洗與處理.html#cb97-3" tabindex="-1"></a></span>
<span id="cb97-4"><a href="資料清洗與處理.html#cb97-4" tabindex="-1"></a><span class="co"># data.table套件</span></span>
<span id="cb97-5"><a href="資料清洗與處理.html#cb97-5" tabindex="-1"></a><span class="fu">merge.data.table</span>(StuInfo_DT, StuScore_DT, <span class="at">all=</span>T, <span class="at">by=</span><span class="st">&quot;StudentID&quot;</span>)</span></code></pre></div>
</div>
<H2 id="inner-join">
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 保留共同擁有的參照欄位之資料</strong>
</p>
</H2>
<p><code>inner_join()</code>的函式撰寫架構亦與前述<A href='#left-join'><code>left_join()</code></A>函式完全相同。</p>
<p>再次以<code>StuInfo</code>與<code>StuScore</code>兩資料為例，利用<code>inner_join()</code>所得結果如下。</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="資料清洗與處理.html#cb98-1" tabindex="-1"></a><span class="fu">inner_join</span>(StuInfo, StuScore, <span class="at">by=</span><span class="st">&quot;StudentID&quot;</span>)</span></code></pre></div>
<pre><code>##   StudentID Class   Name Score
## 1       ID1     A    Bob    60
## 2       ID2     B   Mary    80
## 3       ID4     C  Jason    40
## 4       ID5     D   Jane    50
## 5       ID6     A Jessie   100</code></pre>
<p>由以上結果可知，兩份資料中所有的「StudentID」僅會保留共同擁有的紀錄，而無法匹配資料者逕予以刪除。例如「ID3」在<code>StuScore</code>中無紀錄；「ID7」在<code>StuInfo</code>中無紀錄，故配對後即刪除此二筆資料。</p>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>base</code>與<code>data.table</code>套件連接資料</strong>
</p>
<p>若連接方式為「<strong>保留共同擁有的參照欄位之資料</strong>」，<strong>無須</strong>設定<code>all=</code>或<code>all.x=</code>之引數。函式撰寫架構如下：</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="資料清洗與處理.html#cb100-1" tabindex="-1"></a><span class="fu">merge</span>(資料1, 資料2, <span class="at">by=</span><span class="st">&quot;參照欄位&quot;</span>)</span>
<span id="cb100-2"><a href="資料清洗與處理.html#cb100-2" tabindex="-1"></a><span class="fu">merge.data.table</span>(資料1, 資料2, <span class="at">by=</span><span class="st">&quot;參照欄位&quot;</span>)</span></code></pre></div>
<p>以連接<code>StuInfo</code>與<code>StuScore</code>兩資料為例，參照欄位為「StudentID」。</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="資料清洗與處理.html#cb101-1" tabindex="-1"></a><span class="co"># base套件</span></span>
<span id="cb101-2"><a href="資料清洗與處理.html#cb101-2" tabindex="-1"></a><span class="fu">merge</span>(StuInfo, StuScore, <span class="at">by=</span><span class="st">&quot;StudentID&quot;</span>)</span>
<span id="cb101-3"><a href="資料清洗與處理.html#cb101-3" tabindex="-1"></a></span>
<span id="cb101-4"><a href="資料清洗與處理.html#cb101-4" tabindex="-1"></a><span class="co"># data.table套件</span></span>
<span id="cb101-5"><a href="資料清洗與處理.html#cb101-5" tabindex="-1"></a><span class="fu">merge.data.table</span>(StuInfo_DT, StuScore_DT, <span class="at">by=</span><span class="st">&quot;StudentID&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="重新命名欄位" class="section level2 hasAnchor" number="2.10">
<h2><span class="header-section-number">2.10</span> 重新命名欄位<a href="資料清洗與處理.html#重新命名欄位" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>在第一章節中提及設定資料欄位名稱的方法，可藉由<code>colnames()</code>設定或修改欄位名稱。此外<code>dplyr</code>套件中的<code>rename()</code>函式亦可指定修改名稱的欄位，並賦予新名稱。函式撰寫架構如下。</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="資料清洗與處理.html#cb102-1" tabindex="-1"></a><span class="fu">rename</span>(資料, 新欄位名稱<span class="ot">=</span>舊欄位名稱)</span></code></pre></div>
<p>以修改<code>StuScore</code>資料的名稱為例，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="資料清洗與處理.html#cb103-1" tabindex="-1"></a>StuInfo_rn1<span class="ot">=</span><span class="fu">rename</span>(StuInfo, <span class="at">STUID=</span>StudentID, <span class="at">CLASS=</span>Class)</span>
<span id="cb103-2"><a href="資料清洗與處理.html#cb103-2" tabindex="-1"></a></span>
<span id="cb103-3"><a href="資料清洗與處理.html#cb103-3" tabindex="-1"></a>StuInfo_rn1</span></code></pre></div>
<pre><code>##   STUID CLASS   Name
## 1   ID1     A    Bob
## 2   ID2     B   Mary
## 3   ID3     A Robert
## 4   ID4     C  Jason
## 5   ID5     D   Jane
## 6   ID6     A Jessie</code></pre>
<p>此外，亦可利用<code>rename_with()</code>函式，使修改名稱的方式更有所彈性，其函式撰寫架構如下。</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="資料清洗與處理.html#cb105-1" tabindex="-1"></a><span class="fu">rename_with</span>(資料, 修正函式)</span></code></pre></div>
<p>再以<code>StuScore</code>資料為例，若欲將所有欄位名稱修正為<a href="r-語言基礎語法.html#文字處理">全大寫字母</a>，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="資料清洗與處理.html#cb106-1" tabindex="-1"></a>StuInfo_rn2<span class="ot">=</span><span class="fu">rename_with</span>(StuInfo, toupper)</span>
<span id="cb106-2"><a href="資料清洗與處理.html#cb106-2" tabindex="-1"></a></span>
<span id="cb106-3"><a href="資料清洗與處理.html#cb106-3" tabindex="-1"></a>StuInfo_rn2</span></code></pre></div>
<pre><code>##   STUDENTID CLASS   NAME
## 1       ID1     A    Bob
## 2       ID2     B   Mary
## 3       ID3     A Robert
## 4       ID4     C  Jason
## 5       ID5     D   Jane
## 6       ID6     A Jessie</code></pre>
<p>除可設定既有的函式外，亦可藉由<a href="r-語言基礎語法.html#建立自定義函式">自定義函式</a>修正之，例如若我們希望所有名稱都接上「_A」，則程式碼撰寫如下。</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="資料清洗與處理.html#cb108-1" tabindex="-1"></a><span class="co"># 建立自定義函式</span></span>
<span id="cb108-2"><a href="資料清洗與處理.html#cb108-2" tabindex="-1"></a>paste_A<span class="ot">=</span><span class="cf">function</span>(x){</span>
<span id="cb108-3"><a href="資料清洗與處理.html#cb108-3" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">paste0</span>(x, <span class="st">&quot;_A&quot;</span>))</span>
<span id="cb108-4"><a href="資料清洗與處理.html#cb108-4" tabindex="-1"></a>}</span>
<span id="cb108-5"><a href="資料清洗與處理.html#cb108-5" tabindex="-1"></a></span>
<span id="cb108-6"><a href="資料清洗與處理.html#cb108-6" tabindex="-1"></a><span class="co"># 修正名稱，全部欄位名稱加上「_A」</span></span>
<span id="cb108-7"><a href="資料清洗與處理.html#cb108-7" tabindex="-1"></a>StuInfo_rn3<span class="ot">=</span><span class="fu">rename_with</span>(StuInfo, paste_A)</span>
<span id="cb108-8"><a href="資料清洗與處理.html#cb108-8" tabindex="-1"></a></span>
<span id="cb108-9"><a href="資料清洗與處理.html#cb108-9" tabindex="-1"></a>StuInfo_rn3</span></code></pre></div>
<pre><code>##   StudentID_A Class_A Name_A
## 1         ID1       A    Bob
## 2         ID2       B   Mary
## 3         ID3       A Robert
## 4         ID4       C  Jason
## 5         ID5       D   Jane
## 6         ID6       A Jessie</code></pre>
<p>而若希望有條件式的修正欄位名稱，則可利用<code>.cols=</code>引數設定需要更動的欄位索引值。以<code>StuInfo</code>資料為例，若欲針對欄位名稱具有「a」者，轉換為全大寫，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="資料清洗與處理.html#cb110-1" tabindex="-1"></a>StuInfo_rn4<span class="ot">=</span><span class="fu">rename_with</span>(StuInfo, toupper, <span class="at">.cols=</span><span class="fu">grep</span>(<span class="st">&quot;a&quot;</span>, <span class="fu">colnames</span>(StuInfo)))</span>
<span id="cb110-2"><a href="資料清洗與處理.html#cb110-2" tabindex="-1"></a></span>
<span id="cb110-3"><a href="資料清洗與處理.html#cb110-3" tabindex="-1"></a>StuInfo_rn4</span></code></pre></div>
<pre><code>##   StudentID CLASS   NAME
## 1       ID1     A    Bob
## 2       ID2     B   Mary
## 3       ID3     A Robert
## 4       ID4     C  Jason
## 5       ID5     D   Jane
## 6       ID6     A Jessie</code></pre>
<p>以上程式碼中的<a href="r-語言基礎語法.html#資料框data-frame"><code>colnames()</code></a>函式用以回傳特定資料的名稱，<a href="r-語言基礎語法.html#搜尋字元"><code>grep()</code></a>函式為尋找含括特定字元的元素索引值。</p>
</div>
<div id="去除重複資料" class="section level2 hasAnchor" number="2.11">
<h2><span class="header-section-number">2.11</span> 去除重複資料<a href="資料清洗與處理.html#去除重複資料" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>在第一章節中我們提過可以利用<code>unique()</code>函式篩選出向量的唯一值，亦即將重複的元素予以去除。而若希望刪除重複的資料列，可利用<code>distinct()</code>函式，其撰寫架構如下。</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="資料清洗與處理.html#cb112-1" tabindex="-1"></a><span class="fu">distinct</span>(資料)</span></code></pre></div>
<p>以下範例演示<code>distinct()</code>函式的功能，同時利用<a href="r-語言基礎語法.html#資料框data-frame"><code>duplicated</code></a>函式先行檢查是否有重複的列。</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="資料清洗與處理.html#cb113-1" tabindex="-1"></a><span class="co"># 建立具有重複資料的資料框</span></span>
<span id="cb113-2"><a href="資料清洗與處理.html#cb113-2" tabindex="-1"></a>StuScore_dup<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">StudentID=</span><span class="fu">c</span>(<span class="st">&quot;ID1&quot;</span>,<span class="st">&quot;ID2&quot;</span>,<span class="st">&quot;ID4&quot;</span>,<span class="st">&quot;ID3&quot;</span>,<span class="st">&quot;ID4&quot;</span>,<span class="st">&quot;ID5&quot;</span>,<span class="st">&quot;ID2&quot;</span>),</span>
<span id="cb113-3"><a href="資料清洗與處理.html#cb113-3" tabindex="-1"></a>                        <span class="at">Name=</span><span class="fu">c</span>(<span class="st">&quot;Bob&quot;</span>,<span class="st">&quot;Mary&quot;</span>,<span class="st">&quot;Jason&quot;</span>,<span class="st">&quot;Robert&quot;</span>,<span class="st">&quot;Jason&quot;</span>,<span class="st">&quot;Jane&quot;</span>,<span class="st">&quot;Mary&quot;</span>),</span>
<span id="cb113-4"><a href="資料清洗與處理.html#cb113-4" tabindex="-1"></a>                        <span class="at">Score=</span><span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">80</span>,<span class="dv">40</span>,<span class="dv">100</span>,<span class="dv">40</span>,<span class="dv">100</span>,<span class="dv">80</span>))</span>
<span id="cb113-5"><a href="資料清洗與處理.html#cb113-5" tabindex="-1"></a></span>
<span id="cb113-6"><a href="資料清洗與處理.html#cb113-6" tabindex="-1"></a><span class="co"># 檢查是否有重複列</span></span>
<span id="cb113-7"><a href="資料清洗與處理.html#cb113-7" tabindex="-1"></a><span class="fu">duplicated</span>(StuScore_dup)</span></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="資料清洗與處理.html#cb115-1" tabindex="-1"></a><span class="co"># 去除重複列</span></span>
<span id="cb115-2"><a href="資料清洗與處理.html#cb115-2" tabindex="-1"></a><span class="fu">distinct</span>(StuScore_dup)</span></code></pre></div>
<pre><code>##   StudentID   Name Score
## 1       ID1    Bob    60
## 2       ID2   Mary    80
## 3       ID4  Jason    40
## 4       ID3 Robert   100
## 5       ID5   Jane   100</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>base</code>套件去除重複資料</strong>
</p>
<p><code>unique()</code>函式不僅可去除向量內的重複元素，亦可去除資料框中的重複資料。</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="資料清洗與處理.html#cb117-1" tabindex="-1"></a><span class="fu">unique</span>(StuScore_dup)</span></code></pre></div>
</div>
</div>
<div id="資料集合" class="section level2 hasAnchor" number="2.12">
<h2><span class="header-section-number">2.12</span> 資料集合<a href="資料清洗與處理.html#資料集合" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>資料集合包含交集（intersect）、聯集（union）、差集（difference）、對稱差集（symmetric difference），如圖<a href="資料清洗與處理.html#fig:set-operations-fig">2.2</a>之示意圖所示。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:set-operations-fig"></span>
<img src="figure/set_operations.png" alt="資料集合示意圖" width="80%" />
<p class="caption">
圖 2.2: 資料集合示意圖
</p>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 交集</strong>
</p>
<p>資料交集可利用<code>intersect()</code>函式，撰寫架構如下。其中<code>資料1</code>與<code>資料2</code>的欄位必須相同。</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="資料清洗與處理.html#cb118-1" tabindex="-1"></a><span class="fu">intersect</span>(資料1, 資料2)</span></code></pre></div>
<p>以新建資料<code>data1</code>與<code>data2</code>為例，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="資料清洗與處理.html#cb119-1" tabindex="-1"></a><span class="co"># 建立資料</span></span>
<span id="cb119-2"><a href="資料清洗與處理.html#cb119-2" tabindex="-1"></a>data1<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">Var1=</span><span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;E&quot;</span>), <span class="at">Var2=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>), <span class="at">Var3=</span><span class="fu">c</span>(T,F,T,F,T))</span>
<span id="cb119-3"><a href="資料清洗與處理.html#cb119-3" tabindex="-1"></a>data2<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">Var1=</span><span class="fu">c</span>(<span class="st">&quot;F&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;G&quot;</span>,<span class="st">&quot;E&quot;</span>,<span class="st">&quot;B&quot;</span>), <span class="at">Var2=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">2</span>), <span class="at">Var3=</span><span class="fu">c</span>(F,F,T,T,F))</span>
<span id="cb119-4"><a href="資料清洗與處理.html#cb119-4" tabindex="-1"></a></span>
<span id="cb119-5"><a href="資料清洗與處理.html#cb119-5" tabindex="-1"></a><span class="co"># 交集</span></span>
<span id="cb119-6"><a href="資料清洗與處理.html#cb119-6" tabindex="-1"></a><span class="fu">intersect</span>(data1, data2)</span></code></pre></div>
<pre><code>##   Var1 Var2  Var3
## 1    B    2 FALSE
## 2    D    4 FALSE
## 3    E    5  TRUE</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件取交集</strong>
</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="資料清洗與處理.html#cb121-1" tabindex="-1"></a>data1_DT<span class="ot">=</span><span class="fu">data.table</span>(<span class="at">Var1=</span><span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;E&quot;</span>), <span class="at">Var2=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>), <span class="at">Var3=</span><span class="fu">c</span>(T,F,T,F,T))</span>
<span id="cb121-2"><a href="資料清洗與處理.html#cb121-2" tabindex="-1"></a>data2_DT<span class="ot">=</span><span class="fu">data.table</span>(<span class="at">Var1=</span><span class="fu">c</span>(<span class="st">&quot;F&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;G&quot;</span>,<span class="st">&quot;E&quot;</span>,<span class="st">&quot;B&quot;</span>), <span class="at">Var2=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">2</span>), <span class="at">Var3=</span><span class="fu">c</span>(F,F,T,T,F))</span>
<span id="cb121-3"><a href="資料清洗與處理.html#cb121-3" tabindex="-1"></a></span>
<span id="cb121-4"><a href="資料清洗與處理.html#cb121-4" tabindex="-1"></a><span class="fu">fintersect</span>(data1_DT, data2_DT)</span></code></pre></div>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 聯集</strong>
</p>
<p>資料聯集可利用<code>union()</code>函式，撰寫架構如下。其中<code>資料1</code>與<code>資料2</code>的欄位必須相同。另須注意的是，若資料中有重複者，<code>union()</code>函式會自動去除，若欲回傳所有重複資料，則可使用<code>union_all()</code>函式。</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="資料清洗與處理.html#cb122-1" tabindex="-1"></a><span class="co"># 聯集（去除重複資料）</span></span>
<span id="cb122-2"><a href="資料清洗與處理.html#cb122-2" tabindex="-1"></a><span class="fu">union</span>(資料1, 資料2)</span>
<span id="cb122-3"><a href="資料清洗與處理.html#cb122-3" tabindex="-1"></a></span>
<span id="cb122-4"><a href="資料清洗與處理.html#cb122-4" tabindex="-1"></a><span class="co"># 聯集（保留重複資料）</span></span>
<span id="cb122-5"><a href="資料清洗與處理.html#cb122-5" tabindex="-1"></a><span class="fu">union_all</span>(資料1, 資料2)</span></code></pre></div>
<p>以<code>data1</code>與<code>data2</code>資料為例，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="資料清洗與處理.html#cb123-1" tabindex="-1"></a><span class="co"># 聯集</span></span>
<span id="cb123-2"><a href="資料清洗與處理.html#cb123-2" tabindex="-1"></a><span class="fu">union</span>(data1, data2)</span></code></pre></div>
<pre><code>##   Var1 Var2  Var3
## 1    A    1  TRUE
## 2    B    2 FALSE
## 3    C    3  TRUE
## 4    D    4 FALSE
## 5    E    5  TRUE
## 6    F    6 FALSE
## 7    G    7  TRUE</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件取聯集</strong>
</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="資料清洗與處理.html#cb125-1" tabindex="-1"></a><span class="fu">funion</span>(data1_DT, data2_DT)</span></code></pre></div>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 差集</strong>
</p>
<p>資料差集可利用<code>setdiff()</code>函式，撰寫架構如下。其中<code>資料1</code>與<code>資料2</code>的欄位必須相同。</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="資料清洗與處理.html#cb126-1" tabindex="-1"></a><span class="fu">setdiff</span>(資料1, 資料2)</span></code></pre></div>
<p>再此以<code>data1</code>與<code>data2</code>資料為例，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="資料清洗與處理.html#cb127-1" tabindex="-1"></a><span class="co"># 差集 (data1-data2)</span></span>
<span id="cb127-2"><a href="資料清洗與處理.html#cb127-2" tabindex="-1"></a><span class="fu">setdiff</span>(data1, data2)</span></code></pre></div>
<pre><code>##   Var1 Var2 Var3
## 1    A    1 TRUE
## 2    C    3 TRUE</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="資料清洗與處理.html#cb129-1" tabindex="-1"></a><span class="co"># 差集 (data2-data1)</span></span>
<span id="cb129-2"><a href="資料清洗與處理.html#cb129-2" tabindex="-1"></a><span class="fu">setdiff</span>(data2, data1)</span></code></pre></div>
<pre><code>##   Var1 Var2  Var3
## 1    F    6 FALSE
## 2    G    7  TRUE</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件取差集</strong>
</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="資料清洗與處理.html#cb131-1" tabindex="-1"></a><span class="fu">fsetdiff</span>(data1_DT, data2_DT)</span></code></pre></div>
</div>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 對稱差集</strong>
</p>
<p>資料對稱差集可利用<code>symdiff()</code>函式，撰寫架構如下。其中<code>資料1</code>與<code>資料2</code>的欄位必須相同。</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="資料清洗與處理.html#cb132-1" tabindex="-1"></a><span class="fu">symdiff</span>(資料1, 資料2)</span></code></pre></div>
<p>以<code>data1</code>與<code>data2</code>資料為例，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="資料清洗與處理.html#cb133-1" tabindex="-1"></a><span class="co"># 對稱差集</span></span>
<span id="cb133-2"><a href="資料清洗與處理.html#cb133-2" tabindex="-1"></a><span class="fu">symdiff</span>(data1, data2)</span></code></pre></div>
<pre><code>##   Var1 Var2  Var3
## 1    A    1  TRUE
## 2    C    3  TRUE
## 3    F    6 FALSE
## 4    G    7  TRUE</code></pre>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 檢查兩資料是否完全相同</strong>
</p>
<p>若希望檢查兩資料是否完全相同，可透過<code>setequal()</code>函式檢查之，撰寫架構如下。</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="資料清洗與處理.html#cb135-1" tabindex="-1"></a><span class="fu">setequal</span>(資料1, 資料2)</span></code></pre></div>
<p>以<code>data1</code>與<code>data2</code>資料為例，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="資料清洗與處理.html#cb136-1" tabindex="-1"></a><span class="co"># 對稱差集</span></span>
<span id="cb136-2"><a href="資料清洗與處理.html#cb136-2" tabindex="-1"></a><span class="fu">setequal</span>(data1, data2)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="strong">
<p style="color:#750000;">
<strong>使用<code>data.table</code>套件檢查兩資料是否完全相同</strong>
</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="資料清洗與處理.html#cb138-1" tabindex="-1"></a><span class="fu">fsetequal</span>(data1_DT, data2_DT)</span></code></pre></div>
</div>
</div>
<div id="資料型態轉換" class="section level2 hasAnchor" number="2.13">
<h2><span class="header-section-number">2.13</span> 資料型態轉換<a href="資料清洗與處理.html#資料型態轉換" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>依據資料的長度與寬度，可以將其簡單分為「長資料（long data）」與「寬資料（wide data）」。長資料是指針對不同屬性<strong>逐列羅列</strong>的資料格式，通常資料筆數會較多，會存在許多重複的資料列；寬資料則是指將不同屬性<strong>逐行展開</strong>的資料格式，通常資料筆數較少。以圖<a href="資料清洗與處理.html#fig:melt-dcast-fig">2.3</a>之示意圖為例，若欲記錄學生各科目的成績，有兩種紀錄方式，其一為長資料，亦即將學生、科目、分數分欄紀錄；另一為寬資料，係建立科目別（如示意圖中為「Math」與「English」）欄位，並依序記錄各科目的分數。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:melt-dcast-fig"></span>
<img src="figure/melt_dcast.png" alt="資料型態轉換示意圖" width="85%" />
<p class="caption">
圖 2.3: 資料型態轉換示意圖
</p>
</div>
<p>長資料與寬資料皆有不同的應用時機，舉例而言，在資料統計時，長資料即有利於透過<a href="資料清洗與處理.html#資料分群與統計"><code>group_by() %&gt;% summarise()</code></a>函式分群與統計資料；而寬資料則有利於表格輸出時的數據呈現與觀察。此外，在運輸領域中為瞭解運具、路徑、方案的選擇行為，通常我們會透過<a href="https://www.wikiwand.com/en/Discrete_choice">選擇模型（Discrete Choice Model）</a>作為量化分析的工具，而 R 語言常見的選擇模型套件包含<a href="https://cran.r-project.org/web/packages/mlogit/mlogit.pdf"><code>mlogit</code></a>與<a href="https://www.apollochoicemodelling.com/"><code>apollo</code></a>，兩者皆可在函式中設定使用寬資料或長資料，以利於不同形式資料的讀取。</p>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 長資料轉換為寬資料</strong>
</p>
<p>將長資料轉換為寬資料可以透過<code>data.table</code>套件中的<code>dcast()</code>函式，其撰寫架構如下，請參照圖<a href="資料清洗與處理.html#fig:melt-dcast-fig">2.3</a>關於「欄位」的說明。</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="資料清洗與處理.html#cb139-1" tabindex="-1"></a><span class="fu">dcast</span>(資料, 保留欄位<span class="sc">+</span>保留欄位<span class="sc">+</span>... <span class="sc">~</span> 參照欄位, <span class="at">value.var=</span><span class="st">&quot;展開欄位&quot;</span>)</span></code></pre></div>
<p>「保留欄位」係指在轉換後仍然保留不動的欄位，以圖<a href="資料清洗與處理.html#fig:melt-dcast-fig">2.3</a>中的學生分數資料為例，學生的學號（StuID）與姓名（Name）轉換後仍固定。「參照欄位」為變動欄位的依據，會新增至表頭，如科目（Subject）即為參照欄位，轉換為寬資料後會將該欄位內容新增至表頭。「展開欄位」係指轉換為寬資料後依據「參照欄位」所填入的內容，如分數（Score）即為展開欄位，依據科目將分數依序填入至指定的科目欄位中。</p>
<p>另外<code>dcast()</code>函式可應用於 data.table 與 data.frame 兩種資料型態，惟建議處理大數據時使用 data.table 格式較佳，對於此函式的相容性較高。若欲將原本的 data.frame 格式轉換為 data.table，可利用<a href="資料清洗與處理.html#data.frame-與-data.table"><code>data.table()</code></a>函式新增該資料型態。</p>
<p>具體範例以圖<a href="資料清洗與處理.html#fig:melt-dcast-fig">2.3</a>中的學生分數資料做說明，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="資料清洗與處理.html#cb140-1" tabindex="-1"></a><span class="co"># 建立長資料</span></span>
<span id="cb140-2"><a href="資料清洗與處理.html#cb140-2" tabindex="-1"></a>StuScore<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">StuID=</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each=</span><span class="dv">2</span>),</span>
<span id="cb140-3"><a href="資料清洗與處理.html#cb140-3" tabindex="-1"></a>                    <span class="at">Name=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Robert&quot;</span>, <span class="st">&quot;Mary&quot;</span>), <span class="at">each=</span><span class="dv">2</span>),</span>
<span id="cb140-4"><a href="資料清洗與處理.html#cb140-4" tabindex="-1"></a>                    <span class="at">Subject=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Math&quot;</span>, <span class="st">&quot;English&quot;</span>), <span class="at">times=</span><span class="dv">3</span>),</span>
<span id="cb140-5"><a href="資料清洗與處理.html#cb140-5" tabindex="-1"></a>                    <span class="at">Score=</span><span class="fu">c</span>(<span class="dv">80</span>,<span class="dv">70</span>,<span class="dv">90</span>,<span class="dv">75</span>,<span class="dv">85</span>,<span class="dv">95</span>))</span>
<span id="cb140-6"><a href="資料清洗與處理.html#cb140-6" tabindex="-1"></a></span>
<span id="cb140-7"><a href="資料清洗與處理.html#cb140-7" tabindex="-1"></a><span class="co"># 查看資料</span></span>
<span id="cb140-8"><a href="資料清洗與處理.html#cb140-8" tabindex="-1"></a>StuScore</span></code></pre></div>
<pre><code>##   StuID   Name Subject Score
## 1     1   John    Math    80
## 2     1   John English    70
## 3     2 Robert    Math    90
## 4     2 Robert English    75
## 5     3   Mary    Math    85
## 6     3   Mary English    95</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="資料清洗與處理.html#cb142-1" tabindex="-1"></a><span class="co"># 將長資料轉換為寬資料</span></span>
<span id="cb142-2"><a href="資料清洗與處理.html#cb142-2" tabindex="-1"></a>StuScore_wide<span class="ot">=</span><span class="fu">dcast</span>(StuScore, StuID<span class="sc">+</span>Name <span class="sc">~</span> Subject, <span class="at">value.var=</span><span class="st">&quot;Score&quot;</span>)</span>
<span id="cb142-3"><a href="資料清洗與處理.html#cb142-3" tabindex="-1"></a></span>
<span id="cb142-4"><a href="資料清洗與處理.html#cb142-4" tabindex="-1"></a><span class="co"># 查看資料</span></span>
<span id="cb142-5"><a href="資料清洗與處理.html#cb142-5" tabindex="-1"></a>StuScore_wide</span></code></pre></div>
<pre><code>##   StuID   Name English Math
## 1     1   John      70   80
## 2     2 Robert      75   90
## 3     3   Mary      95   85</code></pre>
<p style="color:#003D79;font-size:18px;line-height:2">
<strong>⌾ 寬資料轉換為長資料</strong>
</p>
<p>將寬資料轉換為長資料可以透過<code>data.table</code>套件中的<code>melt()</code>函式，其撰寫架構如下，請參照圖<a href="資料清洗與處理.html#fig:melt-dcast-fig">2.3</a>以及前文關於「欄位」的說明，此函式同樣建議使用 data.table 格式較佳。</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="資料清洗與處理.html#cb144-1" tabindex="-1"></a><span class="fu">melt</span>(資料, <span class="at">id.vars=</span><span class="fu">c</span>(<span class="st">&quot;保留欄位&quot;</span>, ...),</span>
<span id="cb144-2"><a href="資料清洗與處理.html#cb144-2" tabindex="-1"></a>     <span class="at">measure.vars=</span><span class="st">&quot;展開欄位&quot;</span>,</span>
<span id="cb144-3"><a href="資料清洗與處理.html#cb144-3" tabindex="-1"></a>     <span class="at">variable.name=</span><span class="st">&quot;參照欄位名稱&quot;</span>,</span>
<span id="cb144-4"><a href="資料清洗與處理.html#cb144-4" tabindex="-1"></a>     <span class="at">value.name=</span><span class="st">&quot;展開欄位名稱&quot;</span>)</span></code></pre></div>
<p>再次以學生資料分數為例，將前面使用<code>dcast()</code>函式轉換為寬資料的<code>StuScore_wide</code>進一步透過<code>melt()</code>函式轉換回長資料，程式碼撰寫如下。</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="資料清洗與處理.html#cb145-1" tabindex="-1"></a><span class="co"># 將寬資料轉換為長資料</span></span>
<span id="cb145-2"><a href="資料清洗與處理.html#cb145-2" tabindex="-1"></a>StuScore_long<span class="ot">=</span><span class="fu">melt</span>(StuScore_wide, <span class="at">id.vars=</span><span class="fu">c</span>(<span class="st">&quot;StuID&quot;</span>, <span class="st">&quot;Name&quot;</span>),</span>
<span id="cb145-3"><a href="資料清洗與處理.html#cb145-3" tabindex="-1"></a>                   <span class="at">measure.vars=</span><span class="fu">c</span>(<span class="st">&quot;Math&quot;</span>,<span class="st">&quot;English&quot;</span>), <span class="at">variable.name=</span><span class="st">&quot;Subject&quot;</span>, <span class="at">value.name=</span><span class="st">&quot;Score&quot;</span>)</span>
<span id="cb145-4"><a href="資料清洗與處理.html#cb145-4" tabindex="-1"></a></span>
<span id="cb145-5"><a href="資料清洗與處理.html#cb145-5" tabindex="-1"></a><span class="co"># 查看資料</span></span>
<span id="cb145-6"><a href="資料清洗與處理.html#cb145-6" tabindex="-1"></a>StuScore_long</span></code></pre></div>
<pre><code>##   StuID   Name Subject Score
## 1     1   John    Math    80
## 2     2 Robert    Math    90
## 3     3   Mary    Math    85
## 4     1   John English    70
## 5     2 Robert English    75
## 6     3   Mary English    95</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="r-語言基礎語法.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="資料視覺化.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": "https://github.com/ChiaJung-Yeh/Transport-Analysis/tree/master/02-Data-Tidy.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
