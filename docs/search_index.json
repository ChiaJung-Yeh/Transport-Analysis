[["資料清洗與處理.html", "Chapter 2 資料清洗與處理 2.1 合併資料 2.2 選取資料欄位 2.3 依條件篩選資料 2.4 新增資料屬性 2.5 資料分群與統計 2.6 連接資料 2.7 資料排序 2.8 去除重複資料 2.9 資料集合 2.10 條件判斷 2.11 資料型態轉換", " Chapter 2 資料清洗與處理 資料清洗與處理是分析前的第一步，透過此一步驟可初步觀察資料的趨勢，並以圖表呈現敘述統計結果。此外，在經過完善的資料整理後，尚能進一步建構統計模型或數據分析工具以瞭解資料背後所衍伸之意涵。dplyr與data.table套件是 R 語言中兩大最常見的資料處理工具，請務必安裝並導入該套件。 資料清洗與處理常用之套件與函式彙整如表2.1。 表 2.1: 資料處理重要函式 套件 函式 功能 base merge() 根據指定欄位連接兩資料 dplyr bind_rows() 合併橫列 bind_cols() 合併直行 select() 選取特定欄位 filter() 根據條件篩選資料 mutate() 新增資料屬性（直行） group_by() 將資料依據特定欄位分群` summarise() 將分群的資料予以計算 reframe() 將分群的資料予以計算 slice() 依據分群擷取特定資料 left_join() 根據指定欄位連接兩資料（僅保留左側資料） inner_join() 根據指定欄位連接兩資料（擁有的資料皆須保留） full_join() 根據指定欄位連接兩資料（僅保留共同擁有的資料） arrange() 根據指定欄位將資料排序 rename() 更改欄位名稱 distinct() 去除重複資料 intersect() 尋找兩資料中共同擁有的資料列（交集） union() 保留所有擁有的資料列（聯集，去除重複者） union_all() 保留所有擁有的資料列（聯集，保留重複者） setdiff() 尋找唯獨左側資料擁有的資料列（差集） symdiff() 尋找唯獨其中一份資料擁有的資料列（互斥） setequal() 檢查兩資料是否完全相同（無論排序） case_when() 條件判斷 data.table setDT() 將資料轉換為data.table形式 setkey() 設定data.table資料的主鍵 dcast() 轉換長資料為寬資料 melt() 轉換寬資料為長資料 2.1 合併資料 在第一章節中，我們曾提及資料框的行列合併，包含rbind()與cbind()兩函式，而dplyr套件所提供的bind_rows()與bind_cols()其目的相同，前者用以合併橫列；後者用以合併直行。其中bind_cols()與cbind()兩者功能完全相同。惟rbind()函式的使用前提是，輸入的兩資料必須擁有完全相同的欄位，一旦其中一個欄位不符合即無法合併資料。bind_rows()函式則可較彈性合併資料，針對共同擁有的欄位予以合併，其他則忽略之。具體範例如下。 # 建立兩資料 score_data1=data.frame(Student=c(&quot;Robert&quot;, &quot;Jessie&quot;, &quot;Rose&quot;, &quot;John&quot;), Class=c(&quot;A&quot;, &quot;B&quot;, &quot;D&quot;, &quot;C&quot;), Score=c(&quot;80&quot;, &quot;95&quot;, &quot;70&quot;, &quot;65&quot;)) score_data2=data.frame(Student=c(&quot;Penny&quot;, &quot;Ruby&quot;, &quot;Tom&quot;), Score=c(&quot;90&quot;, &quot;70&quot;, &quot;50&quot;)) rbind(score_data1, score_data2) ## Error in rbind(deparse.level, ...): 變數的行數無效 由以上rbind()函式之範例可知，由於score_data1含有「Class」欄位，而score_data2並不包含，故無法成功合併兩資料。此時可嘗試利用bind_rows()函式，程式碼撰寫如下。 bind_rows(score_data1, score_data2) ## Student Class Score ## 1 Robert A 80 ## 2 Jessie B 95 ## 3 Rose D 70 ## 4 John C 65 ## 5 Penny &lt;NA&gt; 90 ## 6 Ruby &lt;NA&gt; 70 ## 7 Tom &lt;NA&gt; 50 輸出結果中，score_data2雖並無「Class」欄位，仍可將兩資料予以合併，並在缺失的資料中填補NA。 2.2 選取資料欄位 在第一章節中，我們曾提及資料框選取欄位的方法，而dplyr套建亦提供相同功能的select()函式，函式撰寫方法如下。 select(資料, 欄位名稱1, 欄位名稱2, ...) 以選取score_data1資料中的「Student」和「Score」兩欄位為例，程式碼撰寫如下。 select(score_data1, Student, Score) ## Student Score ## 1 Robert 80 ## 2 Jessie 95 ## 3 Rose 70 ## 4 John 65 其他寫法包括`（請回顧選取欄位章節）： # 給定欄位索引 score_data1[, c(1,3)] # 給定欄位名稱 score_data1[, c(&quot;Student&quot;, &quot;Class&quot;)] # 回傳單一欄位 score_data1$Student score_data1$Score 2.3 依條件篩選資料 條件篩選資料可以利用邏輯向量擷取 2.4 新增資料屬性 2.5 資料分群與統計 2.6 連接資料 2.7 資料排序 2.8 去除重複資料 2.9 資料集合 2.10 條件判斷 2.11 資料型態轉換 "]]
