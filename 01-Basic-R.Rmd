```{r setup1, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(data.table)
library(sf)
library(ggplot2)
library(ggsflabel)
library(ggspatial)
library(knitr)
library(kableExtra)
library(TDX)
library(DT)

Sys.setlocale(category = "LC_ALL", locale = "zh_TW.UTF-8")

windowsFonts(A=windowsFont("微軟正黑體"))

client_id=read.csv("./key.txt", header=F)[1,2]
client_secret=read.csv("./key.txt", header=F)[2,2]
access_token=get_token(client_id, client_secret)
```

# **R 語言基礎語法**
本章節系統性介紹 R 語言的重要語法和`dplyr`套件的功能及用法，請務必熟悉各函式，以便後續程式碼撰寫。  

## 物件（Object）
物件是 R 語言中構成資料的基本要素，常見者包含五大類：  

1.  向量（vector）  
2.  層級（factor）  
3.  矩陣（matrix）   
4.  資料框（data frame）  
5.  陣列（list）  


### 向量
<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 向量特徵**</p>  

* 一組值  
* 一維  
* 資料型態可為：數值、文字、邏輯值  

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 利用`c()` 建立向量**</p>  

* **數值向量**
```{r vector1, echo=T, eval=F}
vec1=c(1,2,3,4,5)
```

```{r vector1-show, echo=F, eval=T}
vec1=c(1,2,3,4,5)
vec1
```

* **文字向量**
```{r vector2, echo=T, eval=F}
vec2=c("A","B","C","D","E")
```

```{r vector2-show, echo=F, eval=T}
vec2=c("A","B","C","D","E")
vec2
```

* **邏輯向量**
```{r vector3, echo=T, eval=F}
vec3=c(T,F,T,F,T)
```

```{r vector3-show, echo=F, eval=T}
vec3=c(T,F,T,F,T)
vec3
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 擷取特定向量中特定元素**</p>  

* **在`vec2`中擷取第三個元素**
```{r vector-retrieve1, echo=T, eval=T}
vec2[3]
```

* **在`vec2`中擷取多個連續元素**
```{r vector-retrieve2, echo=T, eval=T}
vec2[2:4]
```

* **在`vec2`中擷取多個非連續元素**
```{r vector-retrieve3, echo=T, eval=T}
vec2[c(1,3,5)]
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 建立連續數值資料**</p> 

```{r vector-continuous1, echo=T, eval=T}
seq(from=2, to=20, by=2)
```

<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 向量運算**</p>  

先行建立一個向量`vec4`。
```{r vector-exg, echo=T, eval=T}
vec4=c(1,9,3,15,6,2,8,12)
```

所有運算的程式碼與結果請參照表\@ref(tab:vector-operation-table)。

```{r vector-operation-table, echo=F, eval=T}
vector_operation=data.frame(ope_name=c("最大值","最小值","全域","總和","平均","中位數","乘積","變異數","標準差"), operation=c("`max(vec4)`","`min(vec4)`","`range(vec4)`","`sum(vec4)`","`mean(vec4)`","`median(vec4)`","`prod(vec4)`","`var(vec4)`","`sd(vec4)`"),
                         result=c(paste0("`", max(vec4), "`"), paste0("`", min(vec4), "`"), paste0("`", paste(range(vec4), collapse="  "), "`"), paste0("`", sum(vec4), "`"), paste0("`", mean(vec4), "`"), paste0("`", median(vec4), "`"), paste0("`", prod(vec4), "`"), paste0("`", round(var(vec4), 3), "`"), paste0("`", round(sd(vec4), 3), "`")))

colnames(vector_operation)=c("運算","程式碼","輸出結果")
kable(vector_operation, booktabs=T, caption="向量運算")%>%
  kable_styling(bootstrap_options=c("striped", "hover"), font_size=14)%>%
  column_spec(1, bold=T)%>%
  row_spec(0, bold=T, color="white", background="#8E8E8E")
```


* **向量長度**  
計算向量中的元素個數。
```{r vector-length, echo=T, eval=T}
length(vec4)
```

* **排序**  

  * `sort()`函式直接將向量予以由小至大之排序  
  * `order()`函式回傳向量由小至大排序後對應原向量的序號  

```{r vector-sort-order, echo=T, eval=T}
sort(vec4)
order(vec4)
```
 
由`sort()`的結果可知，其將`vec4`向量由小至大排序。`order()`則是回傳排序後每一個元素所對應至原向量的序號，例如回傳結果的最後一個值是`4`，表示該向量中最大的數值位於向量的第 4 個元素。根據上述，我們亦可透過如下程式碼達到與`sort()`相同的結果。

```{r vector-sort-order-eg, echo=T, eval=T}
vec4[order(vec4)]
```


* **唯一值**  
去除重複的值。
```{r vector-unique, echo=T, eval=T}
vec_dup=c(1,9,5,2,6,1,8,5,2)
unique(vec_dup)
```

* **檢查使否存在`NA`**  
check if the element is NA  
```{r vector-na, echo=T, eval=T}
vec_na=c(1,9,5,NA,6,NA)
is.na(vec_na)
```


<p style="color:#003D79;font-size:18px;line-height:2">**⌾ 向量運算**</p>  

向量運算以下範例使用`vec4`與新建立的向量`vec5`示範向量的運算。

```{r vector-vec5, echo=T, eval=T}
vec5=c(2,5,8,11,7,4,10,3)
```

* **兩向量運算**    
兩向量運算時，兩組向量的長度（`length()`）務必相同！  
所有運算結果如表\@ref(tab:vector-arithmetic-table)。

```{r vector-arithmetic-table, echo=F, eval=T}
vector_arithmetic=data.frame(ope_name=c("","加法","減法","乘法","除法","取餘數","取除數","內積"), operation=c("", "`vec4+vec5`","`vec4-vec5`","`vec4*vec5`","`vec4/vec5`","`vec4 %% vec5`","`vec4 %/% vec5`","`vec4 %*% vec5`"), result=c("", paste0("`", paste(vec4+vec5, collapse=" "), "`"), paste0("`", paste(vec4-vec5, collapse=" "), "`"), paste0("`", paste(vec4*vec5, collapse=" "), "`"), paste0("`", paste(round(vec4/vec5, 3), collapse=" "), "`"), paste0("`", paste(vec4 %% vec5, collapse=" "), "`"), paste0("`", paste(vec4 %/% vec5, collapse=" "), "`"), paste0("`", paste(vec4 %*% vec5, collapse=" "), "`")))
vector_arithmetic$result[1]="`vec4=c(1,9,3,15,6,2,8,12)`\\\n`vec5=c(2,5,8,11,7,4,10,3)`"
# vector_arithmetic$result[1]="1\\\n2"

colnames(vector_arithmetic)=c("運算","程式碼","輸出結果")
kable(vector_arithmetic, booktabs=T, caption="向量運算")%>%
  kable_styling(bootstrap_options=c("striped", "hover"), font_size=14)%>%
  column_spec(1, bold=T)%>%
  row_spec(0, bold=T, color="white", background="#8E8E8E")


```


